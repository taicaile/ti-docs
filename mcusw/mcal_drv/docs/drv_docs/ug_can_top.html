<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>MCUSW: Can User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ug_can_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Can User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ug_can_intro"></a>
Introduction</h1>
<p>This document details AUTOSAR BSW CAN module implementation</p><ul>
<li>Supported AUTOSAR Release <b>: 4.3.1</b></li>
<li>Supported Configuration Variants <b>: Post-build, Pre-Compile</b></li>
<li>Vendor ID <b>: CAN_VENDOR_ID (44)</b></li>
<li>Module ID <b>: CAN_MODULE_ID (80)</b></li>
</ul>
<p>The CAN driver provides services for basic transmission and reception of CAN frames in both interrupt and polling mode. These components can be used by an application.</p>
<hr/>
 <h1><a class="anchor" id="ug_can_design"></a>
CAN Driver Architecture/Design</h1>
<p>Please refer the CAN design, which is included as part of release (<a class="el" href="design_can_top.html">Can Design Document</a>)</p>
<hr/>
 <h1><a class="anchor" id="ug_can_functional_top"></a>
Functional Description</h1>
<p>The CAN module initializes and controls the internal CAN Controllers of the microcontroller. It provides services to write, read, and configure mailboxes of the Can controllers</p>
<p>Programming of clock source for the can, is beyond the scope of this document. The driver expects user of this module has programmed required clock source.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_id_mapping"></a>
CAN Instance ID mapping and ISR mapping</h2>
<p>16 CAN instances are supported on J7ES and 20 on J7VCL/J7AEP/J7AHP by this driver implementation (2 instances in MCU domain and rest in MAIN domain). The following table lists the mapping between instance of can and controllerId of the configurator</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CAN Instance Id  </th><th class="markdownTableHeadNone">Can Instance  </th><th class="markdownTableHeadNone">Associated ISR   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">MCU CAN 0  </td><td class="markdownTableBodyNone">Can_0_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">MCU CAN 1  </td><td class="markdownTableBodyNone">Can_1_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">MAIN CAN 0  </td><td class="markdownTableBodyNone">Can_2_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">MAIN CAN 1  </td><td class="markdownTableBodyNone">Can_3_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">MAIN CAN 2  </td><td class="markdownTableBodyNone">Can_4_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">MAIN CAN 3  </td><td class="markdownTableBodyNone">Can_5_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">MAIN CAN 4  </td><td class="markdownTableBodyNone">Can_6_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone">MAIN CAN 5  </td><td class="markdownTableBodyNone">Can_7_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">MAIN CAN 6  </td><td class="markdownTableBodyNone">Can_8_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9  </td><td class="markdownTableBodyNone">MAIN CAN 7  </td><td class="markdownTableBodyNone">Can_9_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">MAIN CAN 8  </td><td class="markdownTableBodyNone">Can_10_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">11  </td><td class="markdownTableBodyNone">MAIN CAN 9  </td><td class="markdownTableBodyNone">Can_11_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">MAIN CAN 10  </td><td class="markdownTableBodyNone">Can_12_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">13  </td><td class="markdownTableBodyNone">MAIN CAN 11  </td><td class="markdownTableBodyNone">Can_13_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">14  </td><td class="markdownTableBodyNone">MAIN CAN 12  </td><td class="markdownTableBodyNone">Can_14_Int0ISR   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">MAIN CAN 13  </td><td class="markdownTableBodyNone">Can_15_Int0ISR   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">16  </td><td class="markdownTableBodyNone">MAIN CAN 14  </td><td class="markdownTableBodyNone">Can_16_Int0ISR (J7VCL/J7AEP/J7AHP)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">17  </td><td class="markdownTableBodyNone">MAIN CAN 15  </td><td class="markdownTableBodyNone">Can_17_Int0ISR (J7VCL/J7AEP/J7AHP)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">18  </td><td class="markdownTableBodyNone">MAIN CAN 16  </td><td class="markdownTableBodyNone">Can_18_Int0ISR (J7VCL/J7AEP/J7AHP)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">19  </td><td class="markdownTableBodyNone">MAIN CAN 17  </td><td class="markdownTableBodyNone">Can_19_Int0ISR (J7VCL/J7AEP/J7AHP)   </td></tr>
</table>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_cfg"></a>
Configuration</h2>
<p>The CAN Driver implementation supports multiple configuration variants (refer section <a class="el" href="ug_can_top.html#ug_can_intro">Introduction</a>), the driver expects generated <b><a class="el" href="Can__Cfg_8h.html" title="This file contains generated pre compile configuration file for CAN MCAL driver.">Can_Cfg.h</a> </b> to be present as (<a class="el" href="ug_can_top.html#ug_can_functional_filestruct_top">File Structure</a>). Please refer (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_top">Build</a>) to specify path to generated configuration. The associated can configuration generated files <b>Can_Cfg.c</b> and <b>Can_PBcfg.c</b> to be present as show (<a class="el" href="ug_can_top.html#ug_can_functional_filestruct_top">File Structure</a>)</p>
<p>NOTE: Always use configurator tool for MCAL configuration generation.</p>
<p>The following section details on the un-supported features and additional features added.</p>
<hr/>
 <h3><a class="anchor" id="ug_can_functional_cfg_v"></a>
Variance / Deviation from the specification</h3>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_wakeupfunctionality"></a>
CanWakeupFunctionalityAPI</h4>
<p>Wakeup functionality is not supported, this configuration parameter will NOT enable Can Wakeup Functionality.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_wakeupsupport"></a>
CanWakeupSupport</h4>
<p>Wakeup functionality is not supported, this configuration parameter will NOT enable Can Wakeup Functionality.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_icomgeneral"></a>
CanIcomGeneral</h4>
<p>ICOM feature is not supported and CanIcomGeneral configuration parameters are not supported.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_supportttcanref"></a>
CanSupportTTCANRef</h4>
<p>TTCAN feature is not supported and hence CanIfSupportTTCAN parameter is not supported.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_triggertransmitenable"></a>
CanTriggerTransmitEnable</h4>
<p>The optional trigger-transmit API's are not supported in this release.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_lpdureceivecalloutfunction"></a>
CanLPduReceiveCalloutFunction</h4>
<p>The optional configuration parameter CanLPduReceiveCalloutFunction is not supported in this release.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_cfg_v_canchangebaudrateapi"></a>
CAN_CHANGE_BAUDRATE_API</h4>
<p>Can_ChangeBaudrate API's cannot be turned OFF via CAN_CHANGE_BAUDRATE_API.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_i_canmainfunctionreadwriteapipattern"></a>
CanMainFunctionReadWriteApiPattern</h4>
<p>SWS_Can_00442 states that The API name of <a class="el" href="group__MCAL__CAN__API.html#ga5e38bea2b24862d04bb30a406d592ebe" title="This function performs the polling of RX indications when CAN_RX_PROCESSING is set to POLLING.">Can_MainFunction_Read()</a> shall obey the following pattern:</p><ul>
<li>Can_MainFunction_Read_0()</li>
<li>Can_MainFunction_Read_1() ... and so on, if more than one period (see ECUC_Can_00358) is supported. It's not clear on the expected use. Also, specification say's we can have only one poll function for read and write. Hence this requirement is not implemented.</li>
</ul>
<p>Similarly same w.r.o requirement SWS_Can_00441.</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_i_timeoutincansetcontrollermode"></a>
TimeoutInCanSetControllerMode</h4>
<p>In function Can_SetControllerMode if maximum time CanTimeoutDuration is elapsed, DEM error CAN_E_HARDWARE_ERROR is reported.(Refer SWS_Can_00372 for details).</p>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_i_cansetcontrollermodewakeup"></a>
CanSetControllerModeWakeUp</h4>
<p>Can_SetControllerMode(CAN_T_WAKEUP) will not wait for a "limited time" and will update the state to STOPPED immediately. (Refer SWS_Can_00268 for details).</p>
<hr/>
 <h3><a class="anchor" id="ug_can_functional_i_cfg"></a>
Implementation Specific Configurations</h3>
<p>This driver implementation introduces below listed configurable options</p>
<p>Please refer the CAN design section NON Standard configurable parameters (Refer to Design Document provided in CSP), which is included as part of release (<a class="el" href="design_can_top.html">Can Design Document</a>)</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
<h3><a class="anchor" id="ug_can_functional_i_cfg_s_api_top"></a>
Non Standard Service APIs</h3>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_i_cfg_s_api_rb"></a>
Can_RegisterReadback</h4>
<p>As noted from the previous MCAL implementation, some of the critical configuration registers could potentially be corrupted by other entities (s/w or h/w). One of the recommended detection methods would be to periodically read-back the configuration and confirm configuration is consistent. The service API defined below shall be implemented to enable this detection</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Can_RegisterReadback </td><td>Can potentially be turned OFF (Refer to Design Document provided in CSP)   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>uint32 Can_RegisterReadback ( Can_HWUnitType HWUnit, P2VAR(Can_RegisterReadbackType, AUTOMATIC, CAN_APPL_DATA) RegRbPtr)  </td><td>E_OK: Register read back has been done, E_NOT_OK: Register read back failed   </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>NA  </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>HWUnit </td><td>CAN Hardware microcontroller peripheral unit ID. If this is invalid, then the API will return E_NOT_OK.  </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>RegRbPtr - Pointer to where to store the readback values. If this pointer is NULL_PTR, then the API will return E_NOT_OK. </td><td></td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Std_ReturnType </td><td>E_OK, E_NOT_OK   </td></tr>
</table>
<hr/>
 <h4><a class="anchor" id="ug_can_functional_i_cfg_s_api_lpbck"></a>
Can_TestLoopBackModeEnable</h4>
<p>This service will enable CAN loopback mode.</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Can_TestLoopBackModeEnable </td><td>Can potentially be turned OFF (Refer to Design Document provided in CSP)   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>uint32 <a class="el" href="group__MCAL__CAN__API.html#ga5caa4043e2603c750ec66c13017b7e1c" title="This service will enable CAN loopback mode.">Can_TestLoopBackModeEnable(uint8 Controller, uint8 Mode)</a>  </td><td></td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>18  </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>Controller </td><td>CAN Controller to enable loopback mode.  </td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>Mode </td><td>Mode : 0 - Digital Loopback, 1 - Analog Loopback   </td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Std_ReturnType </td><td>E_OK : Loopback enable successfully E_NOT_OK : Loopback enable failed   </td></tr>
</table>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_cfg_int"></a>
Interrupt Configuration</h2>
<p>The Driver doesn’t register any interrupt service routine(ISR), it’s expected that consumer of this driver registers the required interrupt handler.</p>
<p>For every CAN instance an ISR needs to be registered. The Interrupt number associated with instance of the CAN is detailed in TRM. Please refer CanApp_InterruptConfig () in CAN demo application.</p>
<p>Refer section (<a class="el" href="ug_can_top.html#ug_can_functional_id_mapping">CAN Instance ID mapping and ISR mapping</a>), for association between instance ID and ISR</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_cfg_pwr"></a>
Power-up</h2>
<p>The driver doesn't configure the functional clock and power for the CAN modules. It's expected that secondary boot loader(SBL) power-up the required modules. Please refer SBL documentation.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_cfg_build"></a>
Build and Running the Application</h2>
<p>Please follow steps detailed in section (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_top">Build</a>) to build library or example</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_run_example"></a>
Steps to run example application</h2>
<p>Please follow steps detailed in section (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_top">Build</a>) to build example</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_cfg_memmap"></a>
Memory Mapping</h2>
<p>Various objects of this implementation (e.g. variables, functions, constants) are defined under different sections. The linker command file at (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_eg_linker">Examples Linker File (Select memory location to hold example binary)</a>) defines separate section for these objects. When the driver is integrated, its expected that these sections are created and placed in appropriate memory locations. (Locations of these objects depend on the system design and performance needs)</p>
<table class="doxtable">
<tr>
<td><em><b>Section</b></em> </td><td><em><b> CAN_CODE</b></em> </td><td><em><b> CAN_VAR</b></em> </td><td><em><b> CAN_VAR_NOINIT</b></em> </td><td><em><b> CAN_CONST</b></em> </td><td><em><b> CAN_CONFIG</b></em>  </td></tr>
<tr>
<td><em><b>CAN_START_SEC_VAR_INIT_UNSPECIFIED (.data)</b></em> </td><td></td><td>USED  </td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CAN_DATA_INIT_32_SECTION </b></em> </td><td></td><td>USED  </td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CAN_TEXT_SECTION </b></em> </td><td>USED  </td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CAN_DATA_NO_INIT_UNSPECIFIED_SECTION </b></em> </td><td></td><td></td><td>USED  </td><td></td><td></td></tr>
<tr>
<td><em><b>CAN_CONST_32_SECTION </b></em> </td><td></td><td></td><td></td><td>USED  </td><td></td></tr>
<tr>
<td><em><b>CAN_ISR_TEXT_SECTION </b></em> </td><td>USED  </td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CAN_CONFIG_SECTION </b></em> </td><td></td><td></td><td></td><td></td><td>USED   </td></tr>
</table>
<p>NOTE: It is adviced to use of MPU at the OS level verification through the use of System level Testing. Check Autosar recommendation memory segment placements are followed.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_can_functional_cfg_cache"></a>
Cache</h3>
<p>This driver implementation has been validated with cache enabled. For optimal performance it’s recommended to place (<a class="el" href="ug_can_top.html#ug_can_functional_cfg_memmap">Memory Mapping</a>) sections in cache enabled memory area.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_dep_top"></a>
Dependencies on SW Modules</h2>
<hr/>
<p>NOTE: Pin Muxing should be initialized before initializing the Can module.</p>
<h3><a class="anchor" id="ug_can_functional_dep_det"></a>
DET</h3>
<p>This implementation depends on the DET in order to report development errors and can be turned OFF. Refer section (<a class="el" href="ug_can_top.html#ug_can_error_dev">Development Error Reporting</a>) for detailed error codes.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_can_functional_dep_schm"></a>
SchM</h3>
<p>This implementation requires one level of exclusive access to guard critical sections. Invokes SchM_Enter_Can_CAN_EXCLUSIVE_AREA_0 (), SchM_Exit_Can_CAN_EXCLUSIVE_AREA_0 () to enter critical section and exit.</p>
<p>In the example implementation (<a class="el" href="ug_can_top.html#ug_can_functional_filestruct_top">File Structure</a> SchM_Can.c) , all the interrupts on CPU are disabled. However, disabling of the enabled CAN interrupt should suffice.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_functional_filestruct_top"></a>
File Structure</h2>
<div class="image">
<img src="can_design_dir_2.png" alt="can_design_dir_2.png"/>
<div class="caption">
Detailed Directory Structure</div></div>
<ol type="1">
<li>Driver implemented by : <a class="el" href="Can_8h.html" title="This file contains interface header for CAN MCAL driver.">Can.h</a>, <a class="el" href="Can__Irq_8h.html" title="This file contains cover page for generating doxygen API documentation.">Can_Irq.h</a>, Can.c, Can_Priv.c,Can_Mcan.c Can_Irq.c and Can_Priv.h</li>
<li>Example Configuration by : <a class="el" href="Can__Cfg_8h.html" title="This file contains generated pre compile configuration file for CAN MCAL driver.">Can_Cfg.h</a>, Can_Cfg.c and Can_PBcfg.c</li>
<li>Example Application by : CanApp.c</li>
</ol>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_can_error_top"></a>
Error Handling</h1>
<hr/>
<p> NOTE: Interrupts required for error detection shall be enabled all the time.</p>
<hr/>
 <h2><a class="anchor" id="ug_can_error_dev"></a>
Development Error Reporting</h2>
<p>Development errors are reported to the DET using the service Det_ReportError(), when enabled. The driver interface (<a class="el" href="Can_8h.html" title="This file contains interface header for CAN MCAL driver.">Can.h</a> <a class="el" href="ug_can_top.html#ug_can_functional_filestruct_top">File Structure</a>) lists the SID</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_error_codes"></a>
Error codes</h2>
<div class="image">
<img src="can_design_dev_error.png" alt="can_design_dev_error.png"/>
<div class="caption">
Development Error</div></div>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_error_prod"></a>
Production Code Error Reporting</h2>
<p>Production error are reported to DEM via the service DEM_ReportErrorStatus(). In addition to standard errors, this implementation reports "CAN_E_HARDWARE_ERROR" when CAN hardware register read/write fails.</p>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_can_api_top"></a>
API Description</h1>
<p>The AUTOSAR BSW Can Driver specification details the APIs required for Can Driver. Please refer to (Refer to Design Document provided in CSP) for detailed API description. Also refer to (<a class="el" href="ug_can_top.html#ug_can_functional_i_cfg_s_api_top">Non Standard Service APIs</a>) for non-standard APIs which are included in this implemented.</p>
<p><a class="el" href="group__MCAL__CAN__API.html">Refer API Documentation for details</a> <a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_can_eg_top"></a>
Example Application</h1>
<p>The example application demonstrate use of CAN module, the list below identifies key steps performed the example. The configuration file is present at (<a class="el" href="ug_can_top.html#ug_can_functional_filestruct_top">File Structure</a>)</p>
<ul>
<li>Initializes “Result Status Flag”</li>
<li>CanApp_Startup ()<ul>
<li>Builds interrupt list and registers ISR for enabled CAN instances</li>
</ul>
</li>
<li>CanApp_PowerAndClkSrc ()<ul>
<li>Dummy function for now.</li>
</ul>
</li>
<li>CanApp_PlatformInit ()<ul>
<li>Pinmux configuration required for internal loopback testing mode<ul>
<li>Write 0x08050007 to specific pad config control register for the MCAN trasceiver pin. Further details can be found under Device Configuration &gt; Control Module in TRM.</li>
<li>Confirm the CAN transceiver is enabled by performing a read and compare on the same pin.</li>
</ul>
</li>
<li>Enables CAN Transceiver connected to CAN instances.Please note that for internal loopback testing this is not applicable.</li>
</ul>
</li>
<li>CanApp_LoopbackTest ()<ul>
<li>For each enabled instance<ul>
<li>Initialize CAN hardware</li>
<li>Setup PDU info to tranmist</li>
<li>Set CAN controller mode to START</li>
<li>Enable loopback mode</li>
<li>Trigger CAN transmission</li>
<li>Wait for transmission completion</li>
<li>Check for Tx and Rx confirmation success</li>
<li>Set CAN controller mode to STOP</li>
<li>Disable loopback mode</li>
<li>Compare received message Id and Data with PDU Info</li>
</ul>
</li>
</ul>
</li>
<li>Checks for error status, stack corruption and prints result</li>
</ul>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_can_eg_log"></a>
Example Log</h2>
<pre class="fragment">    CAN_APP: Sample Application - STARTS !!!
    CAN_APP: Variant - Pre Compile being used !!!
    CAN_APP: Successfully Enabled CAN Transceiver Main Domain Inst 4,9,11!!!
    CAN_APP: Successfully Enabled CAN Transceiver MCU MCAN0!!!
    CAN_APP: Successfully Enabled CAN Transceiver MCU MCAN1!!!
    CAN_APP: Message Id Received a0 Message Length is 64     
    CAN_APP: Can Controller Instance MCAN 0 Internal LoopBack Mode Test Passed
    CAN_APP: Message Id Received 800000b0 Message Length is 64   
    CAN_APP: Can Controller Instance MCAN 1 Internal LoopBack Mode Test Passed
    CAN_APP: Message Id Received c0 Message Length is 64     
    CAN_APP: Can Controller Instance MCAN 2 Internal LoopBack Mode Test Passed
    CAN Stack Usage: 856 bytes
    CAN_APP: CAN Test Passed!!!
</pre><p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_can_ref_top"></a>
References</h1>
<ul>
<li><a class="el" href="design_can_top.html">Design Page</a></li>
<li><a href="https://www.autosar.org/fileadmin/user_upload/standards/classic/4-3/AUTOSAR_SWS_CANDriver.pdf">AUTOSAR Spec : Internet Link</a></li>
</ul>
<p><a class="el" href="ug_can_top.html#ug_can_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_can_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">15 Oct 2018  </td><td class="markdownTableBodyNone">Sunil M S  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending Review   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">22 Oct 2018  </td><td class="markdownTableBodyNone">Sunil M S  </td><td class="markdownTableBodyNone">Addressed review comments  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.3  </td><td class="markdownTableBodyNone">27 Dec 2018  </td><td class="markdownTableBodyNone">Vibha Pant  </td><td class="markdownTableBodyNone">Pin Mux Information added  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.4  </td><td class="markdownTableBodyNone">16 Oct 2018  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Added Logs from J721E testing  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.5  </td><td class="markdownTableBodyNone">02 Nov 2020  </td><td class="markdownTableBodyNone">Nikki S  </td><td class="markdownTableBodyNone">J7200 updated  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.6  </td><td class="markdownTableBodyNone">17 Mar 2022  </td><td class="markdownTableBodyNone">Rohit T  </td><td class="markdownTableBodyNone">Removed J721E &amp; J7200 specific contents  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.7  </td><td class="markdownTableBodyNone">08 dec 2022  </td><td class="markdownTableBodyNone">Subham swain  </td><td class="markdownTableBodyNone">J7AEP updated  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.8  </td><td class="markdownTableBodyNone">07 Feb  </td><td class="markdownTableBodyNone">Subham swain  </td><td class="markdownTableBodyNone">J7AHP updated  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.9  </td><td class="markdownTableBodyNone">10 April 2023  </td><td class="markdownTableBodyNone">Rohit T  </td><td class="markdownTableBodyNone">Fixed doxygen warnings  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mcal_ug_top.html">MCAL Module User Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
