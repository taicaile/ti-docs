<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>MCUSW: Cdd Ipc User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ug_cdd_ipc_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cdd Ipc User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ug_cdd_ipc_intro"></a>
Introduction</h1>
<p>This document details Cdd Ipc module implementations</p><ul>
<li>Supported AUTOSAR Release <b>: 4.3.1</b></li>
<li>Supported Configuration Variants <b>: Pre-Compile</b></li>
<li>Vendor ID <b>: CDD_IPC_VENDOR_ID (44)</b></li>
<li>Module ID <b>: CDD_MODULE_ID (255)</b></li>
</ul>
<p>Cdd Ipc modules allows core hosting MCAL/AUTOSAR to communicate with other cores (processing entities, with-in SoC) hosting PDK based IPC driver as well as HLOS Linux IPC driver. This driver could be used to transmit and receive variable length messages between cores, via logical communication channel ID's. Can be mapped to Sender-Receiver AUTOSAR interface, for data oriented communication between core that host AUTOSAR / NON AUTOSAR processing entities.</p>
<p><b>Some of key points to note</b></p><ol type="1">
<li>Can inter-operate with PDK Ipc and Linux IPC drivers</li>
<li>Depends on the built-in mailbox hardware to notify arrival of new message</li>
<li>Relies on shared memory (message would be copied into shared area and destination core notified, the destination core would read this message)</li>
<li>Not configurable (via Cdd Ipc configuration parameters) to use different mailbox, FIFO &amp; user</li>
<li>Interrupt are used, to signal presence of new message destined to this core</li>
<li>For a given channel local and remote endpoint pair is formed.</li>
<li>In case of communication with Linux, remote endpoint is not published upfront, hence it is cached everytime a message a received.</li>
<li>Refer <a class="el" href="demo_cdd_ipc_profile_top.html#demo_cdd_ipc_profile_intro">IPC CDD Profiled Performance</a> to determine the CPU Hz need to transport / receive a message</li>
</ol>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_design"></a>
Cdd Driver Architecture/Design</h1>
<p>Please refer the Cdd IPC design page, which is included as part of release [[2] (Refer to Design Document provided in CSP)</p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_functional_top"></a>
Functional Description</h1>
<div class="image">
<img src="demo_cdd_ipc_ctrl_ep.png" alt="demo_cdd_ipc_ctrl_ep.png"/>
<div class="caption">
Cdd Ipc Architecture</div></div>
<p>As depicted in architecture figure above, Cdd Ipc implementation relies on mailbox, shared memory to transport messages between cores. The shared memory &amp; other associated memories are provided via the configurator, Refer [Shared Memory Configuration] (Refer to Design Document provided in CSP) for details.</p>
<img src="caution.png" style="float: left;" alt="" class="inline"/>
 It's recommended to not change the recommended configuration for these parameters, unless the user comprehends methods to change memory location (and/or size) of the shared memory.</p>
<h2><a class="anchor" id="ug_cdd_ipc_functional_ch"></a>
Communication Channel</h2>
<p>A communication channel provides a logical communication channel between two processors. Identified uniquely by an un-signed sequential integer, represented by configurator defined [symbolic name] (Refer to Design Document provided in CSP).</p>
<p>Refer (SDK Install Directory)/mcusw.xx.yy.zz.bb/mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/include/Cdd_IpcCfg.h for the generated communication channel identifiers.</p>
<p>There could be multiple unique communication channel between any given 2 cores.</p>
<h3><a class="anchor" id="ug_cdd_ipc_functional_ch_ep"></a>
End Point</h3>
<p>There are two primary identifiers, identifying the end-points for a core. This is used by the driver to identify the source / destination of a message.</p><ul>
<li>LocalEp : An unique, non-repetitive integer on the core that hosts MCAL/AUTOSAR</li>
<li>RemoteProcId : An unique processor identifiers, which determines the core that this communication channel is associated with (i.e. to be able to send and receive message to / from that core)</li>
<li>RemoteEp : An unique, non-repetitive integer on the remote core</li>
</ul>
<p>Notes on EndPoints</p><ol type="1">
<li>Shall be unique on a core (either local or remote cores)</li>
<li>Need not be same i.e. localEp = X and remoteEp = Y, is a valid</li>
<li>A communication channel shall have unique end-points, i.e. localEp shall be unique and on remote cores, remoteEp shall be unique</li>
</ol>
<h3><a class="anchor" id="ug_cdd_ipc_functional_ch_buf"></a>
Buffer for each channel</h3>
<ul>
<li>MaxNumMsgQueued : Number of messages that could potentially be received &amp; queued in the driver before, these messages could be received by applications</li>
<li>MaxMsgSize : Size of the largest message that could be received <img src="caution.png" style="float: left;" alt="" class="inline"/>
 The <b>MaxNumMsgQueued</b> &amp; <b>MaxMsgSize</b> is used to determine the memory reserved by the driver. The memory is reserved in (SDK Install Directory)/mcusw.xx.yy.zz.bb/mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/src/Cdd_IpcCfg.c with variable (s) Cdd_IpcCommChBuf_&lt;Channel ID&gt;</li>
</ul>
<h2><a class="anchor" id="ug_cdd_ipc_functional_ch_ctrl_ep"></a>
Control End Point</h2>
<p>The demo application by default uses control channel/Announce API's to notify remote cores of service availability. This feature could be turned OFF <a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_app_custom_no_ctrlep">Refer</a> for steps to turn OFF</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_id_mapping"></a>
Interrupt to ISR mapping</h2>
<p>Please refer to the SOC User Manual for detail.</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_cfg"></a>
Configuration</h2>
<p>The design document details the various configurable parameters of this implementation, please refer section Configurator of [2] (Refer to Design Document provided in CSP)</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
<hr/>
<h3><a class="anchor" id="ug_cdd_ipc_functional_i_cfg_s_api_top"></a>
Non Standard Service APIs</h3>
<hr/>
 <h4><a class="anchor" id="ug_cdd_ipc_functional_i_cfg_s_api_rb"></a>
Cdd_IpcRegisterReadBack</h4>
<p>As noted from the previous MCAL implementation, some of the critical configuration registers could potentially be corrupted by other entities (s/w or h/w). One of the recommended detection methods would be to periodically read-back the configuration and confirm configuration is consistent. The service API defined below shall be implemented to enable this detection</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Cdd_IpcRegisterReadBack </td><td>Can potentially be turned OFF (Refer to Design Document provided in CSP)   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>uint32 Cdd_IpcRegisterReadBack ( uint32 remoteProcId, P2VAR(Cdd_IpcRegRbValues, AUTOMATIC, CDD_APP_DATA) pRegArgs)  </td><td>E_OK: Register read back has been done, E_NOT_OK: Register read back failed   </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>NA  </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>remoteProcId </td><td>Remote Processor ID.  </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>pRegArgs - Pointer to where to store the readback values. If this pointer is NULL_PTR, then the API will return E_NOT_OK. </td><td></td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Std_ReturnType </td><td>E_OK, E_NOT_OK   </td></tr>
</table>
<hr/>
<h4><a class="anchor" id="ug_cdd_ipc_functional_i_cfg_s_api_mbs"></a>
Cdd_IpcGetMailboxStatus</h4>
<p>Service to get Mailbox state is FULL or not</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Cdd_IpcGetMailboxStatus </td><td>Service to get Mailbox state is FULL or not   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>uint32 Cdd_IpcGetMailboxStatus(uint32 chId)  </td><td>E_OK: Register read back has been done, E_NOT_OK: Register read back failed   </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>CDD_IPC_SID_MAILBOX_STATE  </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>remoteProcId </td><td>Remote ID.  </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>None </td><td></td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>uint32 </td><td>Returns the mailbox state   </td></tr>
</table>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="ug_cdd_ipc_functional_cfg_pwr"></a>
Power-up</h2>
<p>The driver doesn't configure the functional clock and power for the Mailbox module. It is expected that the Secondary Bootloader (SBL) powers up the required modules. Please refer SBL documentation.</p>
<p>Note that, this implementation will NOT reset the Mailbox. Un Expected/stale messages could be delivered by the driver. It's recommended to drain stale messages before announcing the availability via service API Cdd_IpcAnnounce () if enabled.</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_cfg_build"></a>
Build and Running the Application</h2>
<p>Please follow steps detailed in section (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_top">Build</a>) to build library or example.</p>
<h3>Build MCAL example application</h3>
<p>The MCAL example application could be built with the command</p>
<pre class="fragment">$ cd (SDK Install Directory)/mcusw.xx.yy.zz.bb/build
$ make cdd_ipc_app CORE=mcu2_1 BOARD=(SOC)_evm SOC=(SOC) -sj
</pre><ul>
<li>The generated executable is available at<ul>
<li>(SDK Install Directory)/mcusw.xx.yy.zz.bb/binary/cdd_ipc_app/bin/(SoC)_evm/cdd_ipc_app_mcu2_1_(BUILD_PROFILE).xer5f</li>
</ul>
</li>
</ul>
<h3>Build MCAL example application for Linux communication</h3>
<p>Navigate to /build/Rules.make and set the CDD_IPC_LINUX_BUILD to yes The MCAL example application could be built with the command</p>
<pre class="fragment">$ cd (SDK Install Directory)/mcusw.xx.yy.zz.bb/build
$ make cdd_ipc_app_rc_linux CORE=(CORE_VARIABLE) BOARD=(SOC)_evm SOC=(SOC) -sj
</pre><p>The possible variable values are</p><ul>
<li>CORE_VARIABLE = mcu2_1, mcu1_0</li>
<li>SOC = j721e, j7200</li>
<li>The generated executable is available at<ul>
<li>(SDK Install Directory)/mcusw.xx.yy.zz.bb/binary/cdd_ipc_app_rc_linux/bin/(SoC)_evm/cdd_ipc_app_rc_linux_(CORE_VARIABLE)_(BUILD_PROFILE).xer5f</li>
</ul>
</li>
</ul>
<hr/>
<h3><a class="anchor" id="ug_cdd_ipc_functional_remoteapp_build"></a>
Building the remote core example application</h3>
<p>The remote core application implementation is available at (SDK Install Directory)/mcusw.xx.yy.zz.bb/mcuss_demos/inter_core_comm/ipc_remote</p>
<p>Note: You can build remote core applications with freertos. Ensure to use the same OS example and remote core application.</p>
<ol type="1">
<li>Change IpcRemoteApp_DstProc = IPC_MCU2_1 from IPC_MCU1_0 in mcusw/mcuss_demos/inter_core_comm/ipc_remote/main_rtos.c</li>
</ol>
<p>Please follow steps detailed in section (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_top">Build</a>) to build library or example</p>
<ol type="1">
<li>Note: There is no special remote app needed for Linux communication/testing.</li>
<li>Linux rpmsg_sample_client app can be used.</li>
</ol>
<hr/>
<h3><a class="anchor" id="ug_cdd_ipc_functional_profileapp_build_tirtos"></a>
Building the MCAL IPC profiling application</h3>
<p>Refer <a class="el" href="demo_cdd_ipc_profile_top.html">IPC Profiling Application</a> for details on the profiling application.</p>
<pre class="fragment">$ cd (SDK Install Directory)/mcusw.xx.yy.zz.bb/build
$ make cdd_ipc_profile_app CORE=mcu2_1 BUILD_OS_TYPE=freertos -sj</pre><ul>
<li>The generated executable is available at<ul>
<li>(SDK Install Directory)/mcusw.xx.yy.zz.bb/binary/cdd_ipc_profile_app_(BUILD_OS_TYPE)/bin/(SOC)_evm/cdd_ipc_profile_app_(BUILD_OS_TYPE)_mcu1_0_release.xer5f</li>
</ul>
</li>
</ul>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<h3><a class="anchor" id="ug_cdd_ipc_functional_profileapp_build_linux"></a>
Building the MCAL IPC profiling application for Linux communication</h3>
<p>Refer <a class="el" href="demo_cdd_ipc_profile_top.html">IPC Profiling Application</a> for details on the profiling application.</p>
<pre class="fragment">$ cd (SDK Install Directory)/mcusw.xx.yy.zz.bb/build
$ make cdd_ipc_profile_app_rc_linux CORE=mcu1_0 BUILD_OS_TYPE=freertos -sj
</pre><ul>
<li>The generated executable is available at<ul>
<li>(SDK Install Directory)/mcusw.xx.yy.zz.bb/binary/cdd_ipc_profile_app_rc_linux/bin/(SoC)_evm/cdd_ipc_profile_app_rc_linux_mcu1_0_(BUILD_PROFILE).xer5f</li>
</ul>
</li>
</ul>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
<h3>Build MCAL Unit Test application</h3>
<p>The MCAL Unit Test application could be built with the command</p>
<pre class="fragment">$ cd (SDK Install Directory)/mcusw.xx.yy.zz.bb/build
$ make -s cdd_ipc_test BOARD=(SOC)_evm SOC=(SOC) BUILD_PROFILE=release CORE=mcu2_1 BUILD_OS_TYPE=baremetal MCAL_CONFIG=x
</pre><table class="doxtable">
<tr>
<td><em><b>CDD IPC(2_1)</b></em> </td><td><em><b> config_1</b></em> </td><td><em><b> config_2</b></em> </td><td><em><b> config_3</b></em> </td><td><em><b> config_4</b></em> </td><td><em><b> config_5</b></em>  </td></tr>
<tr>
<td><em><b>REMOTE(2_0)</b></em> </td><td>ipc_remote_app  </td><td>ipc_remote_app  </td><td>ipc_remote_2chnls_app  </td><td>ipc_remote_app  </td><td>ipc_remote_test1   </td></tr>
</table>
<ul>
<li>The generated executable is available at<ul>
<li>(SDK Install Directory)/mcusw.xx.yy.zz.bb/binary/cdd_ipc_app/bin/(SoC)_evm/cdd_ipc_app_mcu2_1_(BUILD_PROFILE).xer5f</li>
</ul>
</li>
</ul>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
<h3><a class="anchor" id="ug_cdd_ipc_functional_run_example"></a>
Steps to run example application</h3>
<p><b> To run the CddIpcRprocLinuxApp on mcu1_0 </b></p>
<ol type="1">
<li>Download and install the Linux installer<ul>
<li><a href="https://www.ti.com/tool/PROCESSOR-SDK-J721E">PROCESSOR-SDK-LINUX-J721E</a></li>
<li><a href="https://www.ti.com/tool/PROCESSOR-SDK-J7200">PROCESSOR-SDK-LINUX-J7200</a></li>
</ul>
</li>
<li>Partition and flash the SD card using the below mentioned steps<ul>
<li><a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-linux-jacinto7/08_06_01_02/exports/docs/linux/Overview/Processor_SDK_Linux_Formatting_SD_Card.html#formatting-sd-card-on-linux">SD CARD PREPARATION</a></li>
</ul>
</li>
<li>Navigate to (SDK INSTALL DIR)/Makefile and update the UBOOT_DM variable to point to cdd_ipc_app_rc_linux_mcu1_0_release_strip.xer5f binary.<ul>
<li>Navigate to (SDK INSTALL DIR) and run make u-boot on the terminal.</li>
<li>Replace the tispl.bin file in the SD-card inside bootfs with tispl.bin at (SDK INSTALL DIR)/board-support/u-boot_build/a72</li>
<li>Insert SD-card in the board, ensure that the board is in SD card boot mode and power it on.</li>
<li>Once the application core is booted, log in with username root and run the modprobe rpmsg_client_sample count=10 to view the communication logs with all remote cores.</li>
</ul>
</li>
</ol>
<p><b> To run the CddIpcRprocLinuxApp on mcu2_1 </b></p>
<ol type="1">
<li>Download and install the Linux installer<ul>
<li><a href="https://www.ti.com/tool/PROCESSOR-SDK-J721E">PROCESSOR-SDK-RTOS-J721E</a></li>
<li><a href="https://www.ti.com/tool/PROCESSOR-SDK-J7200">PROCESSOR-SDK-LINUX-J7200</a></li>
</ul>
</li>
<li>Partition and flash the SD card using the below mentioned steps<ul>
<li><a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-linux-jacinto7/08_06_01_02/exports/docs/linux/Overview/Processor_SDK_Linux_Formatting_SD_Card.html#formatting-sd-card-on-linux">SD CARD PREPARATION</a></li>
</ul>
</li>
<li>Navigate to ${SD_CARD_PATH}/rootfs/lib/firmware/pdk-ipc<ul>
<li>Remove ipc_echo_test_mcu2_1_release_strip.xer5f and move the cdd_ipc_app_rc_linux_mcu2_1_release_strip.xer5f binary to $SD_CARD_PATH/rootfs/lib/firmware/pdk-ipc</li>
<li>Rename the cdd_ipc_app_rc_linux_mcu2_1_release_strip.xer5f file to ipc_echo_test_mcu2_1_release_strip.xer5f</li>
<li>Remove the old symbolic firmware link for mcu2_1 in $SD_CARD_PATH/rootfs/lib/firmware with rm j7200-main-r5f0_1-fw(for j7200) or rm j7-main-r5f0_1-fw(for j721e)</li>
<li>Recreate the symbolic link with the new firmware for J7200 by sudo ln -s pdk-ipc/ipc_echo_test_mcu2_1_release_strip.xer5f j7200-main-r5f0_1-fw</li>
<li>Recreate the symbolic link with the new firmware for J721E by sudo ln -s pdk-ipc/ipc_echo_test_mcu2_1_release_strip.xer5f j7-main-r5f0_1-fw</li>
<li>Once the application core is booted, log in with username root and run the modprobe rpmsg_client_sample count=10 to view the communication logs with all remote cores.</li>
</ul>
</li>
</ol>
<p>Please refer the SOC user manual for cdd_ipc_app.</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_cfg_memmap"></a>
Memory Mapping</h2>
<p>Various objects of this implementation (e.g. variables, functions, constants) are defined under different sections. The linker command file at (<a class="el" href="mcusw_c_ug_top.html#mcusw_build_eg_linker">Examples Linker File (Select memory location to hold example binary)</a>) defines separate section for these objects. When the driver is integrated, it is expected that these sections are created and placed in appropriate memory locations. (Locations of these objects depend on the system design and performance needs)</p>
<table class="doxtable">
<tr>
<td><em><b>Section</b></em> </td><td><em><b> CDD_IPC_CODE</b></em> </td><td><em><b> CDD_IPC_VAR</b></em> </td><td><em><b> CDD_IPC_VAR_NOINIT</b></em> </td><td><em><b> CDD_IPC_CONST</b></em> </td><td><em><b> CDD_IPC_CONFIG</b></em>  </td></tr>
<tr>
<td><em><b>CDD_IPC_DATA_NO_INIT_UNSPECIFIED_SECTION (.data)</b></em> </td><td></td><td></td><td>USED  </td><td></td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_DATA_INIT_32_SECTION </b></em> </td><td></td><td>USED  </td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_TEXT_SECTION </b></em> </td><td>USED  </td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_DATA_NO_INIT_8_SECTION </b></em> </td><td></td><td></td><td>USED  </td><td></td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_CONFIG_SECTION </b></em> </td><td></td><td></td><td></td><td>USED  </td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_ISR_TEXT_SECTION </b></em> </td><td>USED  </td><td></td><td></td><td></td><td></td></tr>
<tr>
<td><em><b>CDD_IPC_CONFIG_SECTION </b></em> </td><td></td><td></td><td></td><td></td><td>USED   </td></tr>
</table>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_dep_top"></a>
Dependencies on SW Modules</h2>
<hr/>
 <h3><a class="anchor" id="ug_cdd_ipc_functional_dep_det"></a>
DET</h3>
<p>This implementation depends on the DET in order to report development errors and can be turned OFF. Refer to the <a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_error_dev">Development Error Reporting</a> section for detailed error codes.</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_cdd_ipc_functional_dep_schm"></a>
SchM</h3>
<p>This implementation requires 1 level of exclusive access to guard critical sections. Invokes SchM_Enter_Cdd_Ipc_IPC_EXCLUSIVE_AREA_0(), SchM_Exit_Cdd_Ipc_IPC_EXCLUSIVE_AREA_0() to enter critical section and exit.</p>
<p>In the example implementation (SchM_Cdd_Ipc.c), all the interrupts on CPU are disabled. However, disabling of the enabled Mailbox related interrupts should suffice.</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_functional_filestruct_top"></a>
File Structure</h2>
<h3><a class="anchor" id="ug_cdd_ipc_cdd_ipc_filestruct_top"></a>
Cdd Ipc File Structure</h3>
<div class="image">
<img src="cdd_ipc_dir_src.png" alt="cdd_ipc_dir_src.png"/>
<div class="caption">
CDD Ipc Implementation Directory Structure</div></div>
<ul>
<li>Driver implemented by: Cdd_Ipc.c, Cdd_IpcIrq.c &amp; Cdd_IpcPriv.h core driver files</li>
<li>Example Configuration by: Cdd_IpcCfg.c and <a class="el" href="Cdd__IpcCfg_8h.html" title="This file contains generated pre compile configurations for CDD IPC MCAL driver.">Cdd_IpcCfg.h</a></li>
<li>Example Application by: CddIpcApp.c &amp; CddIpcApp.h</li>
<li>Remote Core Application by: main_rtos.c, ipc_utils.c</li>
</ul>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_app_custom_top"></a>
Customizing Examples Application</h1>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_app_custom_no_ctrlep"></a>
Turn OFF Use Of Control End Point</h2>
<p>IPC demo applications use atleast 2 applications running on 2 different cores. Namely <b> <em>ipc_remote_app</em> </b> &amp; <b> <em>cdd_ipc_app</em> </b> OR <b> <em>cdd_ipc_profile_app</em> </b>, these two applications would have to be re built when this features requires to be turned OFF</p>
<ol type="1">
<li>Update MCAL configuration<ol type="a">
<li>Example Application<ol type="i">
<li>The configuration used by this application is present in <b> (SDK Install Directory)/mcusw/mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/soc/(SOC)/mcu1_0 </b><ul>
<li>OR Incase application is being hosted on MCU 2 1 <b> (SDK Install Directory)/mcusw/mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/soc/(SOC)/mcu2_1 </b></li>
</ul>
<ol type="A">
<li>Update the configurator to TURN OFF as show below <div class="image">
<img src="cdd_ipc_ug_no_announce.png" alt="cdd_ipc_ug_no_announce.png"/>
<div class="caption">
Announce API turned OFF</div></div>
</li>
</ol>
</li>
<li>Regenerate the configuration and copy the same into location specified above</li>
</ol>
<ul>
<li>Alternately</li>
</ul>
<ol type="i">
<li>Set the macro <b> CDD_IPC_ANNOUNCE_API </b> to <b> STD_OFF </b> in <a class="el" href="Cdd__IpcCfg_8h.html" title="This file contains generated pre compile configurations for CDD IPC MCAL driver.">Cdd_IpcCfg.h</a></li>
<li>Re compile the MCAL demo application <a class="el" href="mcusw_c_ug_top.html#mcusw_build_lib">User Guide</a></li>
</ol>
</li>
<li>Profiling Application</li>
</ol>
</li>
<li>Update Remote Application configuration</li>
</ol>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_error_top"></a>
Error Handling</h1>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_error_dev"></a>
Development Error Reporting</h2>
<p>Development errors are reported to the DET using the service Det_ReportError(), when enabled. The driver interface files (<a class="el" href="Cdd__IpcCfg_8h.html" title="This file contains generated pre compile configurations for CDD IPC MCAL driver.">Cdd_IpcCfg.h</a> shown in the driver directory structure of the <a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_functional_filestruct_top">File Structure</a> section)</p>
<p>Refer Design Document for detailed [Error Codes] (Refer to Design Document provided in CSP)</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_error_codes"></a>
Error codes</h2>
<p>Production error are reported to DET via Det_ReportError(). Only the error codes in the Cdd Ipc driver specifications are reported which are listed in [] (Refer to Design Document provided in CSP)</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_api_top"></a>
API Description</h1>
<p>The AUTOSAR BSW Eth Driver specification details the APIs [[2] (Refer to Design Document provided in CSP)].</p>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_eg_top"></a>
Example Application</h1>
<h2><a class="anchor" id="ug_cdd_ipc_eg_top_flow_chart"></a>
Flow Chart</h2>
<p>The flow chart below depicts the demo application</p><ul>
<li><b>ipc_remote_app_mpu1_0_release.xa53fg</b> would be hosted on <b>Remote Core</b> (MPU 1 0)</li>
<li><b>cdd_ipc_app_mcu1_0_release.xer5f</b> would be hosted on <b>Local Core</b> (MCU 1 0)</li>
</ul>
<div class="image">
<img src="demo_cdd_ipc_flowchart.png" alt="demo_cdd_ipc_flowchart.png"/>
<div class="caption">
Cdd Ipc Demo Application flow chart</div></div>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_cdd_ipc_eg_logs"></a>
Example Logs</h2>
<h3>MCU 1 0 Linux communication</h3>
<pre class="fragment">rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: new channel: 0x400 -&gt; 0xb!
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 1 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 2 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 3 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 4 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 5 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 6 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 7 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 8 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 9 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 10 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: goodbye!</pre><h3>MCU 2 1 Linux communication</h3>
<pre class="fragment">rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: new channel: 0x400 -&gt; 0xb!
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 1 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 2 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 3 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 4 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 5 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 6 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 7 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 8 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 9 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: incoming msg 10 (src: 0xb)
rpmsg_client_sample virtio0.ti.ipc4.ping-pong.-1.11: goodbye!</pre><h3><a class="anchor" id="ug_cdd_ipc_eg_log_mcu21"></a>
MCU 2 1</h3>
<pre class="fragment">CDD_IPC_APP : CDD IPC MCAL Version Info
CDD_IPC_APP :---------------------
CDD_IPC_APP : Vendor ID           : 44
CDD_IPC_APP : Module ID           : 255
CDD_IPC_APP : SW Major Version    : 1
CDD_IPC_APP : SW Minor Version    : 0
CDD_IPC_APP : SW Patch Version    : 0

CDD_IPC_APP :
CDD_IPC_APP : Sample Application - STARTS !!!
CDD_IPC_APP : Received ti.ipc4.ping-pong as ctrl MSG from MCU 1 1
CDD_IPC_APP : Received ping 0 Iteration 10 from MCU 1 1
CDD_IPC_APP : Received ping 1 Iteration 9 from MCU 1 1
CDD_IPC_APP : Received ping 2 Iteration 8 from MCU 1 1
CDD_IPC_APP : Received ping 3 Iteration 7 from MCU 1 1
CDD_IPC_APP : Received ping 4 Iteration 6 from MCU 1 1
CDD_IPC_APP : Received ping 5 Iteration 5 from MCU 1 1
CDD_IPC_APP : Received ping 6 Iteration 4 from MCU 1 1
CDD_IPC_APP : Received ping 7 Iteration 3 from MCU 1 1
CDD_IPC_APP : Received ping 8 Iteration 2 from MCU 1 1
CDD_IPC_APP : Received ping 9 Iteration 1 from MCU 1 1
CDD_IPC_APP : Received ti.ipc4.ping-pong as ctrl MSG from MCU 2 0
CDD_IPC_APP : Received ping 0 Iteration 10 from MCU 2 0
CDD_IPC_APP : Received ping 1 Iteration 9 from MCU 2 0
CDD_IPC_APP : Received ping 2 Iteration 8 from MCU 2 0
CDD_IPC_APP : Received ping 3 Iteration 7 from MCU 2 0
CDD_IPC_APP : Received ping 4 Iteration 6 from MCU 2 0
CDD_IPC_APP : Received ping 5 Iteration 5 from MCU 2 0
CDD_IPC_APP : Received ping 6 Iteration 4 from MCU 2 0
CDD_IPC_APP : Received ping 7 Iteration 3 from MCU 2 0
CDD_IPC_APP : Received ping 8 Iteration 2 from MCU 2 0
CDD_IPC_APP : Received ping 9 Iteration 1 from MCU 2 0
CDD_IPC_APP : Received ti.ipc4.ping-pong as ctrl MSG from MPU 1 0
CDD_IPC_APP : Received ping 0 Iteration 10 from MPU 1 0
CDD_IPC_APP : Received ping 1 Iteration 9 from MPU 1 0
CDD_IPC_APP : Received ping 2 Iteration 8 from MPU 1 0
CDD_IPC_APP : Received ping 3 Iteration 7 from MPU 1 0
CDD_IPC_APP : Received ping 4 Iteration 6 from MPU 1 0
CDD_IPC_APP : Received ping 5 Iteration 5 from MPU 1 0
CDD_IPC_APP : Received ping 6 Iteration 4 from MPU 1 0
CDD_IPC_APP : Received ping 7 Iteration 3 from MPU 1 0
CDD_IPC_APP : Received ping 8 Iteration 2 from MPU 1 0
CDD_IPC_APP : Received ping 9 Iteration 1 from MPU 1 0
CDD_IPC_APP : Transmitted and Received 10 times
CDD_IPC_APP : Sample Application - Completes !!!</pre><p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_ref_top"></a>
References</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.3.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for CDD Driver &amp; Integration <a href="https://www.autosar.org/fileadmin/user_upload/standards/classic/4-3/AUTOSAR_EXP_CDDDesignAndIntegrationGuideline.pdf">Intranet Link</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">Design Page (<a class="el" href="design_ipc_top.html">Cdd IPC Design Document</a>)   </td></tr>
</table>
<p><a class="el" href="ug_cdd_ipc_top.html#ug_cdd_ipc_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_cdd_ipc_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">14 Apr 2019  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending Review   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">18 Apr 2019  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Addressed Review comments  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.3  </td><td class="markdownTableBodyNone">12 Jul 2019  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Included updates based on J721E  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.4  </td><td class="markdownTableBodyNone">16 Oct 2019  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Added Logs from J721E testing  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.5  </td><td class="markdownTableBodyNone">30 Oct 2020  </td><td class="markdownTableBodyNone">Sunita N  </td><td class="markdownTableBodyNone">Added IPC CDD Linux communication  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.6  </td><td class="markdownTableBodyNone">22 Jun 2020  </td><td class="markdownTableBodyNone">Nikki S  </td><td class="markdownTableBodyNone">1.03.03 Release updates  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.7  </td><td class="markdownTableBodyNone">26 Jun 2023  </td><td class="markdownTableBodyNone">Nikki Shah  </td><td class="markdownTableBodyNone">Updated based on 1.06 release  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.8  </td><td class="markdownTableBodyNone">6 Jul 2023  </td><td class="markdownTableBodyNone">Arush Pant  </td><td class="markdownTableBodyNone">CDD IPC Updates for MCU1_0 Core  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mcal_ug_top.html">MCAL Module User Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
