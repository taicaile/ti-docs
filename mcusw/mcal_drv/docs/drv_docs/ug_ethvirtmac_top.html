<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>MCUSW: Eth Virtual Mac User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ug_ethvirtmac_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eth Virtual Mac User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ug_ethvirtmac_intro"></a>
Introduction</h1>
<p>This document details AUTOSAR BSW ETH module implementation when ETH driver is configured to operate in virtual mac mode</p><ul>
<li>Supported AUTOSAR Release <b>: 4.3.1</b></li>
<li>Supported Configuration Variants <b>: Pre-Compile</b></li>
<li>Vendor ID <b>: ETH_VENDOR_ID (44)</b></li>
<li>Module ID <b>: ETH_MODULE_ID (88)</b></li>
</ul>
<p>The ETH module is documented in the ETH module user guide.[<a class="el" href="ug_eth_top.html">3</a>] This user guide complements the ETH module user guide and documents the virtual mac mode operation of the ETH module. The ETH module user guide should be read in its entirety before reading this user guide.</p>
<dl class="section attention"><dt>Attention</dt><dd>The Eth Virtual Mac Mode driver shall be used only in Processor SDK releases which integrate Ethernet Firmware functionality.</dd></dl>
<p>Following section provides background info on the virtual MAC mode.</p>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_virtmacbasics"></a>
Virtual MAC basics</h1>
<h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_cpswintro"></a>
J721E and J7200 Integrated Ethernet Switch Overview</h2>
<p>The J721E and J7200 SoC includes an integrated Ethernet switch called Common Platform Switch (CPSW). CPSW supports multiple external MAC ports and one host port. CPSW in J721E has 8 MAC ports and CPSW in J7200 has 4 MAC ports.</p>
<p>Applications running on different cores in the Jacinto 7 SoC send and receive Ethernet frames via the host port. Applications running on different cores can simultaneously transmit to / receive from host port. In order to transmit and receive frames, an application on a core requires the following:</p><ul>
<li>Dedicated Tx DMA channel to transmit frames</li>
<li>Dedicated Rx Flow DMA channel to receive frames</li>
<li>Dedicated MAC address allocated to the application. All frames sent by the application will have this as source MAC address.</li>
<li>Configuration of switch classifier to direct received frames to the Rx Flow DMA queues.<ul>
<li>The CPSW allows classification based on different L2/L3 header fields like destination MAC address, source MAC address, EtherType, IP address, etc. <div class="image">
<img src="eth_virtualmac_ug_cpsw.png" alt="eth_virtualmac_ug_cpsw.png"/>
<div class="caption">
CPSW 9 port</div></div>
</li>
</ul>
</li>
</ul>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_j7_multicore_data_path"></a>
J7 Multi core data path</h2>
<div class="image">
<img src="eth_virtualmac_ug_multicore_data_path.png" alt="eth_virtualmac_ug_multicore_data_path.png"/>
<div class="caption">
CPSW 9G port</div></div>
<p>As illustrated above there exits direct data path to CPSW switch host port from all cores</p><ul>
<li>Dedicated Tx channels per application</li>
<li>Rx Flow classification in HW based on L2/L3 headers</li>
<li>Configuration register access limited to master core</li>
</ul>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_master_core_virtual_mac"></a>
Master Core and Virtual MAC concept</h2>
<p>As illustrated previously, there is designated master core. All CPSW configuration is exclusively done from this master core. The master core (called <em>switch R5</em>) is responsible for managing the pool of free Tx DMA channels Rx flows, destination MAC addresses.</p>
<p>Any application running on remote core that wants to establish a data path must send an IPC message to the master core to allocate resources such as Tx channel, Rx flow, destination MAC address. Application running on remote must also send IPC message to master core for the following:</p><ul>
<li>Adding classifier entries to associate L2/L3 header with the specified Rx Flow.</li>
<li>Any switch configuration like adding unicast/multicast address to the switch address resolution table.</li>
</ul>
<p>The master core runs a TI RTOS application called Ethernet Firmware.</p>
<p>Ethernet Firmware (ethfw) functionality:</p><ul>
<li>Ethernet Firmware manages the resource pool</li>
<li>Remote core applications can allocate resources/ configure the switch by sending messages to the remote device server running on Ethernet Firmware.</li>
</ul>
<p>The application running on remote core is said to operate in <b>virtual MAC mode</b> configuration.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_asrethfwinteraction"></a>
AUTOSAR software stack &lt; -&gt; Ethernet Firmware Interaction</h2>
<div class="image">
<img src="eth_virtualmac_ug_asr_ethfw_interaction.png" alt="eth_virtualmac_ug_asr_ethfw_interaction.png"/>
<div class="caption">
AUTOSAR Eth interaction with Ethernet Firmware</div></div>
<p>The Ethernet Remote Device RPC Client is layer under the Ethernet Driver which uses CddIpc to send RPC msgs to the Ethernet Firmware and process the response. The Ethernet Firmware hosts a Ethernet Remote Device RPC Server service for servicing remote cores.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_rpcmsgexchange"></a>
RPC msg exchange between  Eth Driver and Ethernet Firmware</h2>
<p>The Eth Driver uses the CddIpc MCAL to send msg to and recv msg from Ethernet Firmware.</p>
<p>Typical Eth Rpc sequence is illustrated below.</p>
<div class="image">
<img src="eth_virtualmac_ug_msgexchange.png" alt="eth_virtualmac_ug_msgexchange.png"/>
<div class="caption">
RPC msg exchange EthDriver &lt;-&gt; EthFw</div></div>
<p>The rpcCmdComplete callback is a function pointer populated in <a class="el" href="structEth__ConfigType.html" title="Eth configuration type Configuration data of all controller.">Eth_ConfigType</a> structure.</p>
<p>Application may choose to configure the Eth Driver to check for msgs to be processed in <a class="el" href="group__MCAL__ETH__API.html#gacb4bf643bb9beec0e0eeb47d967e9af5" title="The function checks for controller errors and lost frames. Used for polling state changes....">Eth_MainFunction()</a>. In this case, it will regularly schedule calls to <a class="el" href="group__MCAL__ETH__API.html#gacb4bf643bb9beec0e0eeb47d967e9af5" title="The function checks for controller errors and lost frames. Used for polling state changes....">Eth_MainFunction()</a> instead of invoking Eth_NotifyVirtmacMsgReceived() from CddIpcNewMessageNotify.</p>
<p>Ethernet MCAL APIs Eth_DispatchVirtmacXXX are asynchronous APIs that dispatch RPC msg to Ethernet Firmware. The application needs to wait for rpcCmdComplete callback as shown to determine completion of API and the status (SUCCESS/FAIL)</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_virtmacbasics_remotecoresetup"></a>
Remote Core Data Path setup illustration</h2>
<p>The data path setup sequence of the Ethernet Virtual MAC driver is as below.</p>
<div class="image">
<img src="eth_virtualmac_ug_datapathsetup.png" alt="eth_virtualmac_ug_datapathsetup.png"/>
<div class="caption">
Data Path Setup sequence of Autosar Ethernet Driver in Virtual MAC mode</div></div>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_functional_top"></a>
Functional Description</h1>
<p>The ETH driver in virtual MAC mode does not control any of the CPSW submodules like MAC/MDIO/ALE/STATS unlike the standard ETH driver.</p>
<p>The ETH driver in virtual MAC mode supports transmission and reception of packets like the ETH driver in non-virtual MAC mode. The ETH driver uses the UDMA driver APIs to setup data transfers to/from the host port.</p>
<p>The ETH driver implements single UDMA channel for data transmission and single rx flow for data reception. Interrupts can be enabled for DMA transmit and receive completion events.</p>
<p>The DMA transfers are based on descriptors called <em>Host Mode Packet Descriptors</em> (HMPD). The descriptors are given to and retrieved from the UDMA via Ring Accelerators. There are three rings used per data direction in this implementation:</p>
<ul>
<li>Transmit<ul>
<li>Free Queue Ring - Descriptors with the address and length of the buffers to be transmitted are queued into this ring. In normal conditions, only CPSW will dequeue descriptors from this queue.</li>
<li>Completion Queue Ring - Descriptors that correspond to Ethernet frames which have already been consumed by the CPSW are placed in this queue. CPSW is the producer and host is the consumer of this ring.</li>
<li>Tear-down Completion Queue Ring - This ring is used only when the UDMA channel is torn down.</li>
</ul>
</li>
<li>Receive<ul>
<li>Free Queue Ring - Descriptors with the address and length of free buffers to be filled with incoming Ethernet frames are queued into this ring. In normal conditions, only the CPSW will dequeue descriptors from this queue.</li>
<li>Completion Queue Ring - Descriptors that correspond to buffers filled with new data from incoming Ethernet frames are placed in this queue. CPSW is the producer and host is the consumer of this ring.</li>
<li>Tear-down Completion Queue Ring is not used in virtual MAC mode for Rx. This is because there is a single UDMA Rx channel with upto 64 flows The single Udma Rx channel open/close is managed by the Ethernet Firmware.</li>
</ul>
</li>
</ul>
<p>The depth of each ring as well as its associated memory is configurable. The ring memories can be any memory in the system, but it's recommended that they are placed in a fast memory (i.e. OCMRAM or MSMC3). The depth of these rings is determined by the number of TX and RX buffers set in the driver configuration (<b>EthTxBufTotal</b> and <b>EthRxBufTotal</b>).</p>
<p>Similarly, the HMPDs can be placed in any memory of the system, but it's recommended that they are placed in OCMRAM or MSMC3 as well.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_id_mapping"></a>
Ethernet interrupt to ISR mapping</h2>
<p>The following table lists the mapping between Ethernet interrupts and the corresponding interrupt service routines.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Interrupt Number  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Associated ISR   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Configurable  </td><td class="markdownTableBodyNone">DMA RX Completion  </td><td class="markdownTableBodyNone">Eth_RxIrqHdlr_0   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Configurable  </td><td class="markdownTableBodyNone">DMA TX Completion  </td><td class="markdownTableBodyNone">Eth_TxIrqHdlr_0   </td></tr>
</table>
<p>The DMA interrupt numbers can be set via the Ethernet driver configuration parameters <b>dmaTxChIntrNum</b> and <b>dmaRxChIntrNum</b>.</p>
<p>The interrupt numbers passed to the Ethernet driver configuration must be within the range allocated for the core by the Udma LLD resource manager, otherwise the interrupt allocation will fail while enabling the Ethernet controller.</p>
<p>Please refer to the UDMA Driver Resource Manager allocation for further details.</p>
<p>In virtual MAC mode, the ETHTRCV module should not be used as the PHY management is under ownership of Ethernet Firmware.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_cfg"></a>
Configuration</h2>
<p>The Eth Driver implementation in this release only supports the Pre-Compile variant. The driver expects generated <b><a class="el" href="Eth__Cfg_8h.html" title="This file contains generated configuration for ETH MCAL driver.">Eth_Cfg.h</a></b> and <b>Eth_Cfg.c</b> to be present at the locations specified in the <a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_functional_eth_filestruct_top">Eth File Structure</a> section.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_ethvirtmac_functional_cfg_v"></a>
Variance / Deviation from the specification</h3>
<h4><a class="anchor" id="ug_ethvirtmac_functional_cfg_v_unsupportedapis"></a>
Ethernet APIs Not Supported</h4>
<p>APIs not support by the Eth Drvier in non-virtual MAC mode mentioned in Eth Driver user guide [<a class="el" href="ug_eth_top.html">3</a>] are not supported in virtual MAC mode as well. Additionally the following APIs are not supported in virtual MAC mode</p><ul>
<li>Eth_GetEtherStats(): Statistics module cannot be accessed by the Eth Driver operating in virtual MAC mode. In the current release getting the statistics from Ethernet Firmware core via RPC msgs is not supported.</li>
<li>Eth_GetDropCount(): Statistics module cannot be accessed by the Eth Driver working in virtual MAC mode. In the current release getting the statistics from Ethernet Firmware core via RPC msgs is not supported.</li>
<li><a class="el" href="group__MCAL__ETH__API.html#gab0a27206034ea65456d8ad4cbf5d4b19" title="This function reads a transceiver register.">Eth_ReadMii()</a>: In Virtual MAC mode the PHY is not managed by the Eth Transceiver driver. Hence the MII access APIs are also not supported by the Ethernet Driver.</li>
<li><a class="el" href="group__MCAL__ETH__API.html#gad1e74f407c48ef5e1a80b9d1fb33b192" title="This function configures a transceiver register or triggers a function offered by the receiver Servic...">Eth_WriteMii()</a>: In Virtual MAC mode the PHY is not managed by the Eth Transceiver driver. Hence the MII access APIs are also not supported by the Ethernet Driver.</li>
<li><a class="el" href="group__MCAL__ETH__API.html#gac174411671a962b9377f34a530be0814" title="This function updates the physical source address to / from the indexed controller filter.">Eth_UpdatePhysAddrFilter()</a>: The ALE module which requires configuration to update the address filter cannot be accessed by the Eth Driver operating in virtual MAC mode. The driver supports RPC APIs to add/remove unicast/multicast/vlan in the switch by means of Eth_DispatchVirtmacXXX APIs. Refer the Ethernet driver API guide for details [<a class="el" href="ug_eth_top.html#ug_eth_ref_top">1</a>].</li>
</ul>
<p>The reason for having a new set of Eth_DispatchVirtmacXXX instead of invoking the RPC APIs inside the existing Eth_UpdatePhysAddrFilter API is as follows:</p>
<p>As the RPC APIs are asynchronous dispatch APIs it is not possible to abstract their calls from the Eth Driver Client by invoking the APIs within an existing API, such as <a class="el" href="group__MCAL__ETH__API.html#gac174411671a962b9377f34a530be0814" title="This function updates the physical source address to / from the indexed controller filter.">Eth_UpdatePhysAddrFilter()</a>. It would require blocking in the API until response from Ethernet Firmware is received. Blocking would abstract the Ethernet Client from virtual MAC / native MAC mode operation but would pose problems with error handling, hence a new set of APIs which must be explicitly invoked by the Ethernet Driver Client have been implemented.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<h4><a class="anchor" id="ug_ethvirtmac_functional_cfg_v_config"></a>
Ethernet Configuration variance</h4>
<p>As explained in the section <a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_functional_top">Functional Description</a>, the depth of Rx and Tx DMA queues is determined by the number of TX and RX buffers set in the driver configuration (<b>EthTxBufTotal</b> and <b>EthRxBufTotal</b>).</p>
<p>As per AUTOSAR spec [1] the maximum value of EthTxBufTotal and EthRxBufTotal is 255. However the UDMA supports a buffer depth of upto <b>1048575 entries (2^20 - 1) </b> To support usecases that require queue depth greater that 255 buffers, the MCAL configurator for ETH module allows greater than 255 buffers for EthTxBufTotal and EthRxBufTotal.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<h4><a class="anchor" id="ug_ethvirtmac_functional_cfg_v_ethtransceiver"></a>
Ethernet Transceiver</h4>
<p>Ethernet Transceiver should not be used in virtual MAC mode of the Ethernet Driver Hence none of the API of Ethernet Transceiver are supported.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_ethvirtmac_functional_non_std_api_top"></a>
Non Standard Service APIs</h3>
<p>The following vendor specific extension APIs are supported in virtual MAC mode</p><ul>
<li>Eth_DispatchVirtmacInit()</li>
<li>Eth_DispatchVirtmacDeinit()</li>
<li>Eth_NotifyVirtmacMsgReceived()</li>
<li>Eth_DispatchVirtmacSubscribeAllTraffic()</li>
<li>Eth_DispatchVirtmacUnsubscribeAllTraffic()</li>
<li>Eth_DispatchVirtmacSubscribeDstMac()</li>
<li>Eth_DispatchVirtmacUnsubscribeDstMac()</li>
<li>Eth_DispatchVirtmacAssociateIPv4Macaddr()</li>
<li>Eth_DispatchVirtmacDisassociateIPv4Macaddr()</li>
<li>Eth_DispatchVirtmacAddUnicastAddr()</li>
<li>Eth_DispatchVirtmacAddMcastAddr()</li>
<li>Eth_DispatchVirtmacDelAddr()</li>
<li>Eth_DispatchVirtmacAddVlan()</li>
<li>Eth_DispatchVirtmacDelVlan()</li>
<li>Eth_SendCustomNotify()</li>
</ul>
<p>Refer the Ethernet driver API guide for details of these APIs</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="ug_ethvirtmac_functional_cfg_int"></a>
Interrupt Configuration</h2>
<p>The Ethernet driver doesn't register any interrupt handlers (ISR), it is expected that consumer of this driver registers the required interrupt handler.</p>
<p>The Ethernet interrupts are:</p><ul>
<li>TX DMA Completion - Asserted when a packet has been consumed by CPSW for transmission. The interrupt number is configurable and is passed via Ethernet configuration parameters. Please refer to the resource partitioning information for further details about what interrupt numbers are allocated for the MCU</li>
<li>RX DMA Completion - Asserted when a packet has been received. The interrupt number is configurable and is passed via Ethernet configuration parameters. Please refer to the resource partitioning information for further details about what interrupt numbers are allocated for the MCU</li>
</ul>
<p>Other CPSW interrupts (like the Statistics Pending interrupt, MDIO interrupt) are not handled by the driver.</p>
<p>Please refer to the EthApp_InterruptConfig() function in Eth virtual MAC demo application for the implementation details of the interrupt registration.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_cfg_pwr"></a>
Power-up</h2>
<p>The driver doesn't configure the functional clock and power for the Ethernet module. It is expected that the Secondary Bootloader (SBL) powers up the required modules. Please refer SBL documentation.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_cfg_build"></a>
Build and Running the Application</h2>
<p>Example application to illustrate use of Eth Driver in virtual MAC mode is included in mcal examples.</p>
<p>Example app name: eth_virtmac_app Source code : ${MCUSW}/mcal_drv/mcal/examples/Eth/eth_app/target/EthVirtmacApp.c</p>
<p>** J721E ** Eth Driver Configuration: mcal_drv/mcal/examples_config/Eth_Demo_Cfg/output/generated/soc/j721e/mcu2_1 CddIpc Driver Configuration: mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/soc/j721e/mcu2_1</p>
<p>** J7200 ** Eth Driver Configuration: mcal_drv/mcal/examples_config/Eth_Demo_Cfg/output/generated/soc/j7200/mcu2_1 CddIpc Driver Configuration: mcal_drv/mcal/examples_config/CddIpc_Demo_Cfg/output/generated/soc/j7200/mcu2_1</p>
<p>The steps to build the virtual MAC mode application:</p>
<p>** J721E ** </p><pre class="fragment">$ cd mcusw/build/
$ make eth_virtmac_app CORE:=mcu2_1 BOARD:=j721e_evm
</pre><p>** J7200 ** </p><pre class="fragment">$ cd mcusw/build/
$ make eth_virtmac_app CORE:=mcu2_1 BOARD:=j7200_evm
</pre><p>The example binary will be available at:</p>
<p>** J721E ** </p><pre class="fragment">mcusw/binary/eth_virtmac_app/bin/j721e_evm/eth_virtmac_app_mcu2_1_${build_profile}.xer5f
</pre><p>** J7200 ** </p><pre class="fragment">mcusw/binary/eth_virtmac_app/bin/j7200_evm/eth_virtmac_app_mcu2_1_${build_profile}.xer5f
</pre><p>Note on the CddIpc Driver Configuration:</p><ul>
<li>The channel CddIpcConf_IpcComChanId_Cdd_IpcMcu20_EthDevice is the configuration to communicate with the Ethernet Firmware endpoint.</li>
<li>The .remoteEp = 28U is fixed for the Ethernet Firmware and should not be modified.</li>
</ul>
<p><b> In this release, the application demonstrating virtual MAC mode of operation of the Eth Driver is supported only on mcu2_1 core.</b></p>
<h3><a class="anchor" id="ug_ethvirtmac_functional_hostapp_build"></a>
Building the host-side example application</h3>
<p>The GCC compiler is required to build the host-side application.</p>
<p>The steps to build the host-side application in Linux are listed below:</p>
<pre class="fragment">$ cd mcal_drv/mcal/examples/Eth/eth_app/host/
$ make
</pre><h3><a class="anchor" id="ug_ethvirtmac_functional_loopback_build"></a>
Building the target-side example application in loopback mode</h3>
<p>Unlike the Eth example, virtual MAC mode application does not support internal loopback test. This is because the MAC needs to be configured for loopback mode and the MAC configuration is under control of Ethernet Firmware and cannot be configured from Ethernet driver in virtual MAC mode.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_run_example"></a>
Steps to run example application</h2>
<h3><a class="anchor" id="ug_ethvirtmac_function_run_default_example"></a>
Running the  test</h3>
<p>This test consists of two applications: host-side application that runs on a Linux machine, and a target-side application that is loaded to the device (DUT).</p>
<p>Please refer to the <a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_functional_hostapp_build">Building the host-side example application</a> section for instructions to build the host-side application.</p>
<ol type="1">
<li>Connect a CAT5e/CAT6 Ethernet cable to the <em>MCU ETHERNET</em> connector of the J721E or J7200 EVM and to the PC's Ethernet port</li>
<li>Don't setup the Network Connection in Linux, disable automatic connection if needed. The intention is to avoid any frames going to the DUT, other than those sent by the test application</li>
<li>Find the interface name on the host PC side by running the following command:</li>
</ol>
<pre class="fragment">$ ifconfig -s
</pre><ol type="1">
<li>Run the host-side application with root privileges (needed for raw sockets) and specify the interface name to be used, for instance: <pre class="fragment">$ cd mcal_drv/mcal/examples/Eth/eth_app/host/
$ sudo ./EthHostApp -i eth2
</pre></li>
<li>At this point, the host-side application will be waiting for the DUT</li>
<li>On target Load Ethernet Firmware on MAIN_Cortex_R5_0_0.<ul>
<li>${ETHFW}/out/${soc}/R5F/SYSBIOS/${build_profile}/app_remoteswitchcfg_server.xer5f</li>
</ul>
</li>
<li>Run MAIN_Cortex_R5_0_0</li>
<li>Load the target-side application eth_virtmac_app_mcu2_1_${build_profile}.xer5f on MAIN_Cortex_R5_0_1</li>
<li>Run MAIN_Cortex_R5_0_1</li>
<li>The host-side application should detect that the device is now ready and all tests will be run (including frame transmission with and without confirmation, frame reception, filtering MAC addresses, transmission and reception of VLAN tagged packets, transmit throughput, etc)</li>
<li>Check the logs printed in the Linux terminal and verify that the host-side application didn't report any errors</li>
<li>Check the logs printed in the serial console (or CCS console if UART is not enabled) and verify that the target-side application didn't report any errors</li>
</ol>
<p>The example applications on either side (host or target) will report a fail status if any test Ethernet frames is lost. So even frames which are lost due to physical link will cause the example application to report as a failure.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_dep_top"></a>
Dependencies on SW Modules</h2>
<hr/>
 <h3><a class="anchor" id="ug_ethvirtmac_functional_dep_det"></a>
DET</h3>
<p>This implementation depends on the DET in order to report development errors and can be turned OFF. Refer to the <a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_error_dev">Development Error Reporting</a> section for detailed error codes.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_ethvirtmac_functional_dep_schm"></a>
SchM</h3>
<p>This implementation requires 1 level of exclusive access to guard critical sections. Invokes SchM_Enter_Eth_ETH_EXCLUSIVE_AREA_0(), SchM_Exit_Eth_ETH_EXCLUSIVE_AREA_0() to enter critical section and exit.</p>
<p>In the example implementation (SchM_Eth.c), all the interrupts on CPU are disabled. However, disabling of the enabled Ethernet related interrupts should suffice.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="ug_ethvirtmac_functional_dep_cddipc"></a>
CddIpc</h3>
<p>Inorder to send Rpc messages to the Ethernet Firmware core, the CddIpc module is used by the Ethernet driver in virtual MAC mode. The IPC channel configuration to communicate with Ethernet Firmware is given below</p>
<pre class="fragment">    {
        .id = CddIpcConf_IpcComChanId_Cdd_IpcMcu20_EthDevice,
        /**&lt; Unique identifiers for a channel */
        .localEp = 11U,
        /**&lt; Local End Point identifier, on which MCAL/AUTOSAR is hosted */
        .remoteEp = 28U,
        /**&lt; Remote End Point identifier, on remote cores */
        .remoteProcId = CDD_IPC_CORE_MCU2_0,
        /**&lt; Remote Processor Identifier */
        .numMsgQueued = 256U,
        /**&lt; Number of buffer allocated to this communication channel */
        .maxMsgSize = 512,
        /**&lt; Defines the pointer to memory */
        .reserved = 0U,
        /**&lt; Future use if any */
    },
</pre><p><b>It is required to initialize IPC (<a class="el" href="group__MCAL__IPC__API.html#ga8e364a6e4653429d9fea902eb97edfaa" title="Service for CDD Initialization.">Cdd_IpcInit()</a>) before Eth_init() is invoked.</b></p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_functional_filestruct_top"></a>
File Structure</h2>
<h3><a class="anchor" id="ug_ethvirtmac_functional_eth_filestruct_top"></a>
Eth File Structure</h3>
<div class="image">
<img src="eth_ug_dir_detailed.png" alt="eth_ug_dir_detailed.png"/>
<div class="caption">
Ethernet Detailed Directory Structure</div></div>
<ul>
<li>Ethernet driver<ul>
<li>Driver implemented by: Eth.c, Eth_Irq.c, Eth_Priv.c, Eth_Rpc.c, <a class="el" href="Eth_8h.html" title="This file contains the interface of the Ethernet driver.">Eth.h</a>, <a class="el" href="Eth__Irq_8h.html" title="This file contains ISR function declaration for Ethernet driver.">Eth_Irq.h</a>, Eth_Priv.h, Eth_RpcPriv.h, Eth_Rpc.h and CPSW core driver files</li>
<li>Example Configuration by: Eth_Cfg.c and <a class="el" href="Eth__Cfg_8h.html" title="This file contains generated configuration for ETH MCAL driver.">Eth_Cfg.h</a></li>
<li>Example Application by: EthVirtmacApp.c, EthUtils.c, EthUtils.h and EthUtils_Patterns.h</li>
</ul>
</li>
</ul>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_error_top"></a>
Error Handling</h1>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_error_dev"></a>
Development Error Reporting</h2>
<p>Development errors are reported to the DET using the service Det_ReportError(), when enabled. The driver interface files <a class="el" href="Eth_8h.html" title="This file contains the interface of the Ethernet driver.">Eth.h</a> lists the service IDs.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_error_codes"></a>
Error codes</h2>
<p>Production error are reported to DET via Det_ReportError(). Only the error codes in the Ethernet and Ethernet Transceiver driver specifications are reported which are listed below. There are no implementation specific error codes being reported.</p>
<h3><a class="anchor" id="ug_ethvirtmac_drv_error_codes"></a>
Ethernet driver error codes</h3>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>Invalid controller index  </td><td>ETH_E_INV_CTRL_IDX  </td><td>0x01   </td></tr>
<tr>
<td>Eth module was not initialized  </td><td>ETH_E_UNINIT  </td><td>0x02   </td></tr>
<tr>
<td>Invalid pointer in parameter list  </td><td>ETH_E_PARAM_POINTER  </td><td>0x03   </td></tr>
<tr>
<td>Invalid parameter  </td><td>ETH_E_INV_PARAM  </td><td>0x04   </td></tr>
<tr>
<td>Initialization failure  </td><td>ETH_E_INIT_FAILED  </td><td>0x05   </td></tr>
<tr>
<td>Invalid mode  </td><td>ETH_E_INV_MODE  </td><td>0x06   </td></tr>
<tr>
<td>Mismatch in API version supported by Ethernet Firmware and Autosar Ethernet Driver  </td><td>ETH_E_VIRTMAC_APIMISMATCH  </td><td>0x07   </td></tr>
<tr>
<td>Dispatch of Virtual MAC RPC command failed  </td><td>ETH_E_VIRTMAC_RPCCMDFAILED  </td><td>0x08   </td></tr>
<tr>
<td>Ethernet MCAL RPC client received unhandled notify from Ethernet Firmware server  </td><td>ETH_E_VIRTMAC_UNSUPPORTECLIENTNOTIFY  </td><td>0x09   </td></tr>
<tr>
<td>Rpc Command sent by client not supported by server  </td><td>ETH_E_VIRTMAC_UNSUPPORTEDSRVCMD  </td><td>0x0A   </td></tr>
</table>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_error_prod"></a>
Production Code Error Reporting</h2>
<p>Production error are reported to DEM via the service DEM_ReportErrorStatus(). There are no implementation specific error codes being reported. Only the error codes in the Ethernet and Ethernet Transceiver driver specifications are reported which are listed below.</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em>  </td></tr>
<tr>
<td>Ethernet Controller Access Failure  </td><td>ETH_E_ACCESS   </td></tr>
<tr>
<td>Ethernet Frames Lost  </td><td>ETH_E_RX_FRAMES_LOST   </td></tr>
<tr>
<td>CRC Failure  </td><td>ETH_E_CRC   </td></tr>
<tr>
<td>Frame Size Underflow  </td><td>ETH_E_UNDERSIZEFRAME   </td></tr>
<tr>
<td>Frame Size Overflow  </td><td>ETH_E_OVERSIZEFRAME   </td></tr>
<tr>
<td>Frame Alignment Error  </td><td>ETH_E_ALIGNMENT   </td></tr>
<tr>
<td>Single Frame Collision  </td><td>ETH_E_SINGLECOLLISION   </td></tr>
<tr>
<td>Multiple Frame Collision  </td><td>ETH_E_MULTIPLECOLLISION   </td></tr>
<tr>
<td>Late Frame Collision  </td><td>ETH_E_LATECOLLISION   </td></tr>
</table>
<p><br />
</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_api_top"></a>
API Description</h1>
<p>The AUTOSAR BSW Eth Driver specification details the APIs [<a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_ref_top">1</a>].</p>
<p>The additional vendor specific APIs for virtual MAC mode are documented in the API guide The APIs not supported in virtual MAC mode are documented at <a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_functional_cfg_v_unsupportedapis">Ethernet APIs Not Supported</a></p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_eg_top"></a>
Example Application</h1>
<p>The example application demonstrate use of Eth module in virtual MAC mode.</p>
<p>The example consists of an application that runs on the J721E or J7200 device (DUT) and an application that runs on a Linux PC (host). The host and target (DUT) applications communicate with each other to start the different stages of the example tests.</p>
<p>The Eth example relies on shared utils which provide helper functions (i.e. filling an Ethernet frame with test data, verifying frame contents, etc) which are useful on the DUT and host sides.</p>
<p>The following table summarizes the different tests implemented by the example application.</p>
<table class="doxtable">
<tr>
<td><b>Test ID</b> </td><td><b>Summary</b> </td><td><b>Description</b>  </td></tr>
<tr>
<td>test_0001 </td><td>Basic DUT frame reception </td><td>Host will send 1000 Ethernet frames, the DUT will receive and verify that the frame content matches the expected patterns   </td></tr>
<tr>
<td>test_0002 </td><td>Basic DUT frame transmission </td><td>The DUT will send 1000 non-VLAN tagged frames without TX confirmation. The host PC will check that all frames are received and that the frame content matches the expected patterns   </td></tr>
<tr>
<td>test_0003 </td><td>External loopback </td><td>The DUT will send frames to the host, the host will receive the frames and will send them back to the DUT   </td></tr>
<tr>
<td>test_0004 </td><td>Default filter operation </td><td>Host will send 500 frames with DUT's MAC address and 500 frames with other MAC address. The DUT will reject the 500 frames that don't matches DUT's address   </td></tr>
<tr>
<td>test_0005 </td><td>Different filter configurations </td><td>This test is split in different stages that will exercise different filter operations like adding/removing unicast address. The virtual MAC mode does not support promiscouse mode as that would involve changing the switch configuration affection other clients.   </td></tr>
<tr>
<td>test_0006 </td><td>DUT frame transmission with confirmation </td><td>The DUT will send 1000 non-VLAN tagged frames and will request TX confirmation. The host PC will check that all frames are received and that the frame content matches the expected patterns.   </td></tr>
<tr>
<td>test_0007 </td><td>Transmission of VLAN tagged frames </td><td>The DUT will send 1000 VLAN tagged frames and will request TX confirmation. The host PC will check that all frames are received and that the frame content matches the expected patterns   </td></tr>
<tr>
<td>test_0008 </td><td>Transmission of different frame lengths </td><td>The DUT will send non-VLAN tagged frames of different lengths, including short frames. The host PC will check that all frames are received and that the frame content matches the expected patterns   </td></tr>
<tr>
<td>test_0009 </td><td>VLAN tagged frame reception </td><td>Host will send 1000 VLAN tagged Ethernet frames, the DUT will receive and verify that the frame content matches the expected patterns   </td></tr>
<tr>
<td>test_0010 </td><td>Controller mode changes </td><td>The application will set the controller to DOWN mode and then back to ACTIVE mode. Ethernet frame transmission and reception tests will be run afterwards. 10 iterations of these steps will be executed.   </td></tr>
<tr>
<td>test_0100 </td><td>Transmit throughput </td><td>DUT transmit throughput is measured over 150,000 Ethernet frames sent from the host PC.   </td></tr>
</table>
<p>The following list identifies key steps performed by the DUT side application:</p>
<ul>
<li>EthVirtmacApp_ethStartup()<ul>
<li>Interrupt controller initialization and ISR registration for the following interrupts:<ul>
<li>TX DMA completion</li>
</ul>
</li>
<li>RX DMA completion</li>
<li>Initialize counters required for timed operations</li>
</ul>
</li>
<li>EthVirtmacApp_ipcStartup()<ul>
<li>Register for the following CddIpc Interrupt:<ul>
<li>Mailbox receive interrupt for mailbox msgs received from MCU2_0.</li>
<li>MCU2_0 is the core on which Ethernet Firmware runs.</li>
</ul>
</li>
</ul>
</li>
<li>EthVirtmacApp_ipcInit()<ul>
<li>Init the Cdd_Ipc Precompile configuration.</li>
<li><a class="el" href="group__MCAL__IPC__API.html#ga8e364a6e4653429d9fea902eb97edfaa" title="Service for CDD Initialization.">Cdd_IpcInit()</a></li>
</ul>
</li>
<li>EthVirtmacApp_init()<ul>
<li>Ethernet driver<ul>
<li>Ethernet driver initialization (<a class="el" href="group__MCAL__ETH__API.html#ga5d7a2ab7987412f33d9f36f24216a656" title="This function initializes the driver.">Eth_Init()</a>)</li>
<li>Wait for Ethernet Firmware to connect with the Ethernet Driver.<ul>
<li>Pend on a semaphore posted by EthVirtmacApp_rpcFwRegistered()</li>
</ul>
</li>
<li>Allocate resources from Ethernet Firmware required to establish data path (EthVirtmacApp_virtmacInit())<ul>
<li>Eth_DispatchVirtmacInit() and wait for Rpc Command completion with succes status<ul>
<li>Pend on a semaphore posted by EthVirtmacApp_rpcCmdComplete()<ul>
<li>EthVirtmacApp_rpcCmdComplete posts semaphore when it received a Cmd Complete callback with the expected SID {Eth_DispatchVirtmacInit()} and status is SUCCESS</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Put controller to active mode (<a class="el" href="group__MCAL__ETH__API.html#ga07088f1594c14ef1d9b5ad0a52bad477" title="This function enables / disables the indexed controller.">Eth_SetControllerMode()</a>)</li>
<li>Get and print the physical address (<a class="el" href="group__MCAL__ETH__API.html#gaafc915c5b06fd70c6c90d6fe16d22b05" title="This function obtains the physical source address used by the indexed controller.">Eth_GetPhysAddr()</a>)</li>
<li>Subscribe to default addresses.<ul>
<li>Configure the switch to direct the default addresses to the Receive Flow owned by the Ethernet Driver. Subscribing to the flow is required for the EThernet Driver to receive the packets<ul>
<li>Subscribe to the unicast MAC address allocated to the Ethernet Driver (returned by <a class="el" href="group__MCAL__ETH__API.html#gaafc915c5b06fd70c6c90d6fe16d22b05" title="This function obtains the physical source address used by the indexed controller.">Eth_GetPhysAddr()</a>)</li>
<li>Subscribe to the special multicast address used by the host app to send control commands</li>
<li>Add broadcast address to switch address resolution table. Add MAC_PORT_2 and MAC_PORT_3 to broadbcast address membership.<ul>
<li>Host port is not added to broadcast address membsership to prevent random broadcast packets from being received by the Ethernet Driver</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Loop through all tests<ul>
<li>EthApp_test_0001: Basic DUT frame reception test:<ul>
<li>Send test START command</li>
<li>Receive frames until the STOP is detected</li>
</ul>
</li>
<li>EthApp_test_0002: Basic DUT frame transmission test:<ul>
<li>Send test START command</li>
<li>Transmit 1000 non-VLAN tagged frames without confirmation</li>
</ul>
</li>
<li>EthApp_test_0003: External loopback test. The DUT sends frames to the host, the host receives the frames and sends them back to the DUT. The following operations are performed on the DUT side:<ul>
<li>Send START command</li>
<li>Send and receive 1000 frames, for each of them:<ul>
<li>A different payload is set</li>
<li>EtherType and payload are verified on the received frame</li>
</ul>
</li>
</ul>
</li>
<li>EthApp_test_0004: Default filter operation. Test the operation of the default DUT's filter configuration (only frames with DUT's MAC address are accepted, all others are rejected). The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Receive frames until the STOP is detected</li>
<li>The number of frames expected to be received is 500 as only one half of the total frames sent by the host (1000) have the DUT's MAC address</li>
</ul>
</li>
<li>EthApp_test_0005: Different filter configurations test. Test the different modes of the DUT's filter configuration. The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Part 1<ul>
<li>Filter is reset to accept only frames with DUT's MAC address</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is not DUT's. It should be rejected</li>
<li>Expected to receive 500 frames</li>
</ul>
</li>
</ul>
</li>
<li>Part 2<ul>
<li>A second unicast MAC address is added to the DUT's filter</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is second valid MAC address. It should be accepted</li>
<li>Expected to receive 1000 frames</li>
</ul>
</li>
</ul>
</li>
<li>Part 3<ul>
<li>A multicast address is added to the DUT's filter</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is multicast address. It should be accepted</li>
<li>Expected to receive 1000 frames</li>
</ul>
</li>
</ul>
</li>
<li>Part 4<ul>
<li>The multicast address is removed from the DUT's filter</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is multicast address. It should be rejected</li>
<li>Expected to receive 500 frames</li>
</ul>
</li>
</ul>
</li>
<li>Part 5<ul>
<li>Another unicast address is added to the DUTs switch address resolution table</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is the newly added unicast address. It should be accepted</li>
<li>Expected to receive 1000 frames</li>
</ul>
</li>
</ul>
</li>
<li>Part 6<ul>
<li>The filter is reset back to accept only DUT's unicast address</li>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>Receive frames until STOP is detected<ul>
<li>Frame 1: Source MAC address is DUT's. It should be accepted</li>
<li>Frame 2: Source MAC address is not DUT's. It should be rejected</li>
<li>Expected to receive 500 frames</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>EthApp_test_0006: Transmission with confirmation test. DUT frame transmission test with TX confirmation. The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Transmit 1000 non-VLAN tagged frames with confirmation</li>
</ul>
</li>
<li>EthApp_test_0007: Transmission of VLAN tagged frames test. DUT frame transmission test of VLAN tagged frames. The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Transmit 1000 VLAN tagged frames with confirmation</li>
</ul>
</li>
<li>EthApp_test_0008: Transmission of different frame lengths. DUT frame transmission test of different frame lengths, including short frames (less than 64 octets). The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Transmit 10 frames for lengths starting at 10 octets in increments of 10 octets until 1500 octets</li>
</ul>
</li>
<li>EthApp_test_0009: VLAN tagged frame reception test<ul>
<li>Host side transmits 1000 frames and then transmits the STOP command</li>
<li>The DUT performs these operations:<ul>
<li>Send START command</li>
<li>Receive frames until the STOP is detected</li>
</ul>
</li>
<li>The number of frames expected to be received is 1000</li>
</ul>
</li>
<li>EthApp_test_0010: Controller mode change test. The DUT performs the following operations:<ul>
<li>Send START command</li>
<li>Run 10 iterations of:<ul>
<li>Unsubscribe all destination MAC address from the Rx flow owned by the Ethernet Driver</li>
<li>Set controller mode to DOWN state</li>
<li>Set controller mode to ACTIVE state</li>
<li>Subscribe to unicast address owned by the Ethernet Driver and subscribe to special multicast address used by test app.</li>
<li>Transmit frames (run test 0002)</li>
<li>Receive frames (run test 0001)</li>
</ul>
</li>
</ul>
</li>
<li>EthApp_test_0100: DUT transmit throughput test. Measure DUT transmit throughput over 150000 frames<ul>
<li>Host side transmits 150000 frames and then transmits the STOP command</li>
<li>The DUT performs the following operations:<ul>
<li>Get the initial timestamp corresponding to the first frame received</li>
<li>Receive frames until the STOP is detected and get the final timestamp</li>
<li>Compute the transmit throughput from the number of received frames and the time difference between the two captured timestamps</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>EthApp_deinit()<ul>
<li>Put the controller in down mode (<a class="el" href="group__MCAL__ETH__API.html#ga07088f1594c14ef1d9b5ad0a52bad477" title="This function enables / disables the indexed controller.">Eth_SetControllerMode()</a>)</li>
</ul>
</li>
<li>Check for error status and print the result</li>
</ul>
<p>The host application steps are not presented in this guide, but can be found documented in the host side code. Please refer to the <a class="el" href="ug_eth_top.html#ug_eth_functional_filestruct_top">File Structure</a> section for the directory where the HostApp.c file can be found.</p>
<p>The configuration files are present can be found at the directories shown in the <a class="el" href="ug_eth_top.html#ug_eth_functional_filestruct_top">File Structure</a> section.</p>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="ug_ethvirtmac_eg_log"></a>
Example Log</h2>
<h5>Target-side application log</h5>
<h3><a class="anchor" id="ug_ethvirtmac_eg_log_j721e"></a>
J721E/J7200</h3>
<h4>Default (non-loopback) example application log</h4>
<h5>Target-side application log</h5>
<pre class="fragment">[MAIN_Cortex_R5_0_1] Eth Application Starts
 
 CDD IPC MCAL Version Info
---------------------
 Vendor ID           : 44
 Module ID           : 255
 SW Major Version    : 9
 SW Minor Version    : 0
 SW Patch Version    : 0
 
MAC Port 1 Address: 70:ff:76:1d:92:c1
Waiting for Host..
No Response from Host, remaining retry = 100
Host App detected! Sending Read ACK CMD...


-----------------------------------------------------------
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0002: START
test_0002: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0003: START
test_0003: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0004: START
test_0004: received 500 of 500 frames
test_0004: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0005: START
test_0005:  Null: Exp1: exp 500, got 500
test_0005:  Null: Exp2: exp   0, got   0
test_0005: Ucast: Exp1: exp 500, got 500
test_0005: Ucast: Exp2: exp 500, got 500
test_0005: Mcast: Exp1: exp 500, got 500
test_0005: Mcast: Exp2: exp 500, got 500
test_0005: Mcast: Exp1: exp 500, got 500
test_0005: Mcast: Exp2: exp   0, got   0
test_0005: Bcast: Exp1: exp 500, got 500
test_0005: Bcast: Exp2: exp 500, got 500
test_0005:  Null: Exp1: exp 500, got 500
test_0005:  Null: Exp2: exp   0, got   0
test_0005: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0006: START
test_0006: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0007: START
test_0007: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0008: START
test_0008: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0009: START
test_0009: received 1000 of 1000 frames
test_0009: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0010: START
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
EthApp_CtrlModeIndication: DOWN
EthApp_CtrlModeIndication: ACTIVE
test_0002: START
test_0002: END
test_0001: START
test_0001: received 1000 of 1000 frames
test_0001: END
test_0010: completed 10 of 10 iterations
test_0010: END
Test Result: Pass
-----------------------------------------------------------


-----------------------------------------------------------
test_0100: START
test_0100: 150000 frames sent
test_0100: END
Test Result: Pass
-----------------------------------------------------------

ETH Stack Usage: 1784 bytes
Final Tests Results: PASS
Eth Application Completed
</pre><p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_ref_top"></a>
References</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.3.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for Eth Driver <a href="https://www.autosar.org/fileadmin/user_upload/standards/classic/4-3/AUTOSAR_SWS_EthernetDriver.pdf">Intranet Link</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">Design Page (<a class="el" href="design_eth_top.html">Eth Design Document</a>)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">Eth User Guide (<a class="el" href="ug_eth_top.html">Eth &amp; EthTrcv User Guide</a>)   </td></tr>
</table>
<p><a class="el" href="ug_ethvirtmac_top.html#ug_ethvirtmac_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="ug_ethvirtmac_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">14 Feb 2020  </td><td class="markdownTableBodyNone">Badri S  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending Review   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">29 May 2020  </td><td class="markdownTableBodyNone">Misael Lopez  </td><td class="markdownTableBodyNone">Updated for AUTOSAR 4.3.1  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.3  </td><td class="markdownTableBodyNone">04 Nov 2020  </td><td class="markdownTableBodyNone">Misael Lopez  </td><td class="markdownTableBodyNone">Updated for SDK 7.1  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mcal_ug_top.html">MCAL Module User Guide</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
