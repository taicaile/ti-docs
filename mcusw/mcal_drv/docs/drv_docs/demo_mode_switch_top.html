<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>MCUSW: Mode Switch Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('demo_mode_switch_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Mode Switch Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="demo_mode_switch_intro_1"></a>
Introduction</h1>
<hr/>
<p>SoC's such as J721E/J7200, integrates a MicroController Unit Subsystem (MCU SS) as a chip-in-chip. It operates using a separate voltage supply, clock sources and resets and includes the components needed for device management. This allows the MCUSS to function continuously regardless of the state of the rest of the device.</p>
<p>This application demonstrates steps to switch mode from ACTIVE (full SoC powered ON) to MCU Only mode and then from MCU Only to ACTIVE mode on J721E EVM.</p>
<p>Table below lists acronyms for different modes of the device</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>MCU Only</b>  </td><td class="markdownTableBodyNone">Power to main domain is turned OFF and no compute core/hardware accelerators can be used. MCU domain is functional   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>ACTIVE</b>  </td><td class="markdownTableBodyNone">Main and MCU domains are functional   </td></tr>
</table>
<p>Table below list SoC on which this demo application is supported and tested </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">SoC  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">J721E  </td><td class="markdownTableBodyNone">Requires beta j721e evm with TPS6594-Q1 PMIC   </td></tr>
</table>
<hr/>
<h2>References</h2>
<ul>
<li>The application note (<a href="https://www.ti.com/lit/pdf/slvubr0">Link</a>), details steps required to power SoC with PMIC TPS6594-Q1</li>
<li>J721E Schematics / Layout (<a href="https://www.ti.com/tool/J721EXSOMXEVM">Link</a>)</li>
</ul>
<hr/>
 <h2><a class="anchor" id="demo_mode_switch_depend"></a>
Dependencies</h2>
<p>This application depends on multiple components and are detailed in sections below</p><ol type="1">
<li>MCUSW Demo : Uses <a class="el" href="demo_boot_app_mcu_rtos_top.html">Boot App</a> to start application on compute core and <b> mode switch app </b> on MCU 10</li>
<li>PDK : Uses I2C driver to control &amp; Configure PMIC</li>
<li>TI RTOS : Uses Task</li>
<li>UNIFLASH Utility - To flash binaries into on-board flash <a href="https://www.ti.com/tool/UNIFLASH">UNIFLASH ON TI.COM</a></li>
<li>JTAG : When in MCU ONLY mode JTAG would be powered down, recommend not to use CCS to execute this application</li>
<li>OSCILLOSCOPE : Required to test / check voltage at test points (TP)</li>
</ol>
<p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="demo_mode_switch_flowchart"></a>
Flow Chart</h1>
<p>The application <b>MCU ONLY Task</b> is hosted on MCU R5F and switches the SoC between ACTIVE and MCU ONLY modes.</p>
<div class="image">
<img src="ModeSwitchFlowChart.PNG" alt="ModeSwitchFlowChart.PNG"/>
<div class="caption">
Flow Chart</div></div>
<p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="demo_mode_switch_demo_build_top"></a>
Build Instructions</h1>
<p>This application is part of <a class="el" href="demo_boot_app_mcu_rtos_top.html">Boot App</a> and is disabled by default and requires to be enabled.</p>
<h2><a class="anchor" id="demo_mode_switch_demo_build_enable"></a>
Enabling the application</h2>
<ul>
<li>In file (MCUSW Install Dir)/mcuss_demos/boot_app_mcu_rtos/makefile</li>
<li>The MCUONLYFUNC controls enabling/disabling of this application</li>
<li>Set MCUONLYFUNC to enabled i.e. <b> MCUONLYFUNC ?= enabled </b></li>
</ul>
<h2><a class="anchor" id="demo_mode_switch_demo_build_link"></a>
Building</h2>
<p>Follow the instructions specified in <a class="el" href="demo_boot_app_mcu_rtos_top.html#demo_boot_app_mcu_rtos_prep_dep">Boot App - Build Instructions</a></p>
<p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="demo_mode_switch_steps_2_run"></a>
Steps to run</h1>
<ul>
<li>Steps to run is detailed in <a class="el" href="demo_boot_app_mcu_rtos_top.html#demo_boot_app_mcu_rtos_steps_2_run">Boot App - Steps to run</a></li>
</ul>
<p><b>J721E</b>:</p><ol type="1">
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/pdk_jacinto_07.x.x/packages/ti/boot/sbl/binary/j721e_evm/cust/bin/sbl_cust_img_mcu1_0_release.tiimage</em> @ <b>0</b></li>
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/pdk_jacinto_07.x.x/packages/ti/drv/sciclient/soc/V1/tifs.bin</em> @ <b>80000</b></li>
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/mcusw/binary/can_boot_app_mcu_rtos/bin/j721e_evm/can_boot_app_mcu_rtos_mcu1_0_release.appimage</em> @ <b>100000</b></li>
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/mcusw/mcuss_demos/boot_app_mcu_rtos/main_domain_apps/binary/bin/j721e_evm/multicore_MCU2_0_MCU2_1_stage1.appimage</em> @ <b>1fc0000</b></li>
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/mcusw/mcuss_demos/boot_app_mcu_rtos/main_domain_apps/binary/bin/j721e_evm/multicore_DSPs_MCU3_0_MCU3_1_stage2.appimage</em> @ <b>27c0000</b></li>
<li><em>coresdk_rtos_jacinto_xx_yy_xx_bb/mcusw/mcuss_demos/boot_app_mcu_rtos/main_domain_apps/binary/bin/j721e_evm/multicore_MPU1_0_stage3.appimage</em> @ <b>37c0000</b></li>
</ol>
<ul>
<li>Important points to note<ul>
<li>Ensure UART / Serial port is not connected while programming flash</li>
<li>BOOT Mode<ul>
<li>UART Boot Mode : SW8: 0000_0000, SW9: 0111_0000</li>
<li>OSPI Boot Mode : SW8: 0000_0000, SW9: 0100_0000</li>
</ul>
</li>
<li>When in <b>MCU Only</b> JTAG would be disconnected</li>
</ul>
</li>
</ul>
<hr/>
<h2><a class="anchor" id="demo_mode_switch_steps_2_run_check_power_rails"></a>
Check power rails</h2>
<p>When operating in ACTIVE mode or MCU only mode, one could check power supply provided on different rails. The table below list different test-point/power rails that could be probed</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode  </th><th class="markdownTableHeadNone">Test Point  </th><th class="markdownTableHeadNone">Expected Voltage   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ACTIVE</b>  </td><td class="markdownTableBodyNone">TP133  </td><td class="markdownTableBodyNone">1.8v   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>ACTIVE</b>  </td><td class="markdownTableBodyNone">TP134  </td><td class="markdownTableBodyNone">1.8v   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>MCU Only</b>  </td><td class="markdownTableBodyNone">TP133  </td><td class="markdownTableBodyNone">1.8v   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>MCU Only</b>  </td><td class="markdownTableBodyNone">TP134  </td><td class="markdownTableBodyNone">0.0v   </td></tr>
</table>
<div class="image">
<img src="ModeSwitchTPLayout1.png" alt="ModeSwitchTPLayout1.png"/>
<div class="caption">
TPs Highlighted</div></div>
<p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="demo_mode_switch_steps_2_run_logs"></a>
LOGs</h2>
<p>Below is the log from one of the test runs</p>
<div class="fragment"><div class="line">Starting Sciserver..... PASSED</div><div class="line"></div><div class="line">MCN Response App:NOTE : Operating in internal loop-bacCAN Response App:NOTE : Operating in internal loop-back mode</div><div class="line">CAN Response App:Message Id Received c00000c0 Message Length is 64</div><div class="line">CAN Response App:Test completed for 0 instance</div><div class="line"></div><div class="line">CAN Response App:NOTE : Operating in internal loop-back mode</div><div class="line">CAN Response App:Message Id Received c00000b0 Message Length is 64</div><div class="line">C OSPI NOR device ID: 0x5b1a, manufacturer ID: 0x2c</div><div class="line">Length is 64</div><div class="line">CAN Response App:Test completed for 1 instance</div><div class="line"></div><div class="line">CAN Response App:Test completed for 1 instance</div><div class="line"></div><div class="line">CAN Response App: 8192 bytes used for stack</div><div class="line">CAN Response App:Early CAN completed!!!</div><div class="line">Boot App: Started at 479 usec</div><div class="line">Boot App: Total Num booted cores = 8</div><div class="line">Boot App: Booted Core ID #6 at 198915 usecs</div><div class="line">Boot App: Booted Core ID #7 at 199123 usecs</div><div class="line">Boot App: Booted Core ID #8 at 266195 usecs</div><div class="line">Boot App: Booted Core ID #9 at 266400 usecs</div><div class="line">Boot App: Booted Core ID #10 at 266594 usecs</div><div class="line">Boot App: Booted Core ID #11 at 266774 usecs</div><div class="line">Boot App: Booted Core ID #12 at 267433 usecs</div><div class="line">Boot App: Booted Core ID #0 at 296580 usecs</div><div class="line"></div><div class="line">MCU Boot Task started at 478 usecs and finished at 4938455 usecs</div><div class="line">MCU only app: BootApp Task to completed!</div><div class="line">MCU only app: Inside MCU ONLY task!</div><div class="line">MCU only app: Disabling MAXT_OUTRG_EN for TMPSENS1:4 in MAIN domain!</div><div class="line">MCU only app: STATE INFO :: CURRENTLY IN ACTIVE MODE!</div><div class="line">MCU only app: LED LD5 should be ON</div><div class="line">MCU only app: Sleeping for 5s, please measure TP133 and TP134!</div><div class="line">MCU only app: Expected values in ACTIVE mode:</div><div class="line">TP133: HIGH</div><div class="line">TP134: HIGH</div><div class="line">MCU only app: ############################ACTIVE -&gt; MCU ONLY MODE############################</div><div class="line">MCU only app: Issueing a SW reset to the MAIN domain...</div><div class="line">MCU only app: PMIC STATE CHANGE: ACTIVE -&gt; MCU ONLY...</div><div class="line">MCU only app: INT_TOP = 0xc</div><div class="line">MCU only app: INT_STARTUP = 0x2</div><div class="line">MCU only app: INT_GPIO = 0xa</div><div class="line">MCU only app: INT_GPIO1_8 = 0xc8</div><div class="line">MCU only app: Read FSM_NSLEEP_TRIGGERS = 0x0</div><div class="line">MCU only app: Write FSM_NSLEEP_TRIGGERS = 0x2</div><div class="line">MCU only app: Read FSM_NSLEEP_TRIGGERS = 0x2</div><div class="line">MCU only app: Write INT_STARTUP = 0x2</div><div class="line">MCU only app: INT_TOP = 0x4</div><div class="line">MCU only app: Write INT_STARTUP = 0xc8</div><div class="line">MCU only app: INT_GPIO = 0x2</div><div class="line">MCU only app: INT_TOP = 0x4</div><div class="line">MCU only app: Write INT_GPIO = 0x2</div><div class="line">MCU only app: Final Read INT_TOP = 0x0</div><div class="line">MCU only app: Final Read FSM_NSLEEP_TRIGGERS = 0x2</div><div class="line">MCU only app: PMIC STATE CHANGE: ACTIVE -&gt; MCU ONLY...Done</div><div class="line">MCU only app: #########################ACTIVE -&gt; MCU ONLY MODE DONE##########################</div><div class="line">MCU only app: STATE INFO :: NOW IN MCU ONLY MODE!</div><div class="line">MCU only app: LED LD5 should be OFF</div><div class="line">MCU only app: Sleeping for 5s, please measure TP133 and TP134!</div><div class="line">MCU only app: Expected values in MCU ONLY mode:</div><div class="line">TP133: HIGH</div><div class="line">TP134: LOW</div><div class="line">MCU only app: ############################MCU ONLY -&gt; ACTIVE MODE############################</div><div class="line">MCU only app: PMIC STATE CHANGE: MCU ONLY -&gt; ACTIVE...</div><div class="line">MCU only app: INT_TOP = 0x0</div><div class="line">MCU only app: Write CONFIG_1 = 0xc0</div><div class="line">MCU only app: Write FSM_NSLEEP_TRIGGERS = 0x3</div><div class="line">MCU only app: Write CONFIG_1 = 0x0</div><div class="line">MCU only app: Read FSM_NSLEEP_TRIGGERS = 0x3</div><div class="line">MCU only app: PMIC STATE CHANGE: MCU ONLY -&gt; ACTIVE...Done</div><div class="line">MCU only app: Configure WKUPMCU2MAIN and MAIN2WKUPMCU Bridges...</div><div class="line">MCU only app: WKUPMCU2MAIN and MAIN2WKUPMCU Bridges configured successfully!</div><div class="line">MCU only app: Configuring Sciclient_board for MAIN domain</div><div class="line">MCU only app: Initiallizing MAIN PLLS...</div><div class="line">MCU only app: Initiallizing MAIN CLOCKS...</div><div class="line">MCU only app: Initiallizing DDR...</div><div class="line">MCU only app: Trying to access MAIN domain peripherals...</div><div class="line">MCU only app: Writing to DDR...</div><div class="line">MCU only app: Reading from DDR...</div><div class="line">MCU only app: Read value matches the value written for DDR!</div><div class="line">MCU only app: Writing to MSMC...</div><div class="line">MCU only app: Reading from MSMC...</div><div class="line">MCU only app: Read value matches the value written for MSMC!</div><div class="line">MCU only app: Reading MAIN MCAN0 Revision register...</div><div class="line">MCU only app: MAIN MCAN0 MCANSS_PID = 0x68e04901</div><div class="line">MCU only app: #########################MCU ONLY -&gt; ACTIVE MODE DONE##########################</div><div class="line">MCU only app: STATE INFO :: CURRENTLY IN ACTIVE MODE!</div><div class="line">MCU only app: LED LD5 should be ON</div><div class="line">MCU only app: Expected values in ACTIVE mode:</div><div class="line">TP133: HIGH</div><div class="line">TP134: HIGH</div><div class="line">MCU only app: Enterting an infinite loop...</div><div class="line">MCU only app: As the full chip is powered ON you can connect JTAG</div><div class="line">MCU only app: Connect CCS via JTAG at this point and access DDR, MSMC and other MAIN domain perepherals (eg - MCAN)!!</div></div><!-- fragment --><p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="demo_boot_app_mode_switch_mcu_rtos_known_issues"></a>
Known Issues</h1>
<ol type="1">
<li>When switching from MCU ONLY mode back to ACTIVE mode, currently loading of firmares on the MAIN domain cores is not supported.</li>
</ol>
<p><a class="el" href="demo_mode_switch_top.html">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="demo_mode_switch_rev_history"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">12 Jan 2021  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Initial Version  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="demo_top.html">MCUSS Demo Applications</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
