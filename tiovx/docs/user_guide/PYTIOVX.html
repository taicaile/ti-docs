<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIOVX User Guide: PyTIOVX User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIOVX User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('PYTIOVX.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PyTIOVX User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a></li>
<li class="level1"><a href="#INSTALLATION">Installation</a></li>
<li class="level1"><a href="#USAGE">Usage</a></li>
<li class="level1"><a href="#KERNEL_SCRIPT">Kernel Generation</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The PyTIOVX Tool allows users to generate an OpenVX extension kernel wrapper by specifying parameters of the kernel and setting relationships between these parameters. <br />
<br />
 'tiovx' is the python module that is used to specify OpenVX graph in a compact manner using predefined classes and objects. After specification of OpenVX graph using PyTIOVX APIs, it can be exported in various formats including C code, JPG image</p>
<h1><a class="anchor" id="INSTALLATION"></a>
Installation</h1>
<ul>
<li>Install Python 3.5.2 or later (<a href="https://www.python.org/">https://www.python.org/</a>)<ul>
<li>To confirm "python" and "pip" are in your install path, type below <div class="fragment"><div class="line">python3 --version</div><div class="line">pip3 --version</div></div><!-- fragment --></li>
</ul>
</li>
<li>Install 'dot' tool provided as part of 'graphviz' (<a href="http://www.graphviz.org/">http://www.graphviz.org/</a>) <br />
 'dot' is required to generated .JPG file for a OpenVX graph specification<ul>
<li>To confirm "dot" tool is in your install path, type <div class="fragment"><div class="line">dot -V</div></div><!-- fragment --></li>
</ul>
</li>
<li>Install 'tiovx' python module by executing below command at folder "&lt;tiovx install path&gt;/tools/PyTIOVX" <div class="fragment"><div class="line">sudo pip3 install -e .</div></div><!-- fragment --> Expected output, <div class="fragment"><div class="line">Obtaining file:///&lt;tiovx install path&gt;/tiovx/tools/PyTIOVX</div><div class="line">Installing collected packages: tiovx</div><div class="line">  Running setup.py develop <span class="keywordflow">for</span> tiovx</div><div class="line">Successfully installed tiovx-0.1</div></div><!-- fragment --></li>
<li>Now tiovx python module can be imported and used in your python script by doing below, <div class="fragment"><div class="line"><span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div></div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="USAGE"></a>
Usage</h1>
<ul>
<li>Describe your application graph or kernel wrapper using PyTIOVX APIs in a .py file. Execute the .py file by invoking python <div class="fragment"><div class="line">python my_kernel_wrapper.py</div></div><!-- fragment --> Note: if the following error is observed, please run using the command "python3.5 my_use_case.py" <div class="fragment"><div class="line">Traceback (most recent call last):</div><div class="line">    File <span class="stringliteral">&quot;kernel_generate_example.py&quot;</span>, line 6, <span class="keywordflow">in</span> &lt;module&gt;</div><div class="line">        <span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div><div class="line">    File <span class="stringliteral">&quot;tiovx/__init__.py&quot;</span>, line 63, <span class="keywordflow">in</span> &lt;module&gt;</div><div class="line">        <span class="keyword">from</span> .enums <span class="keyword">import</span> *</div><div class="line">    File <span class="stringliteral">&quot;tiovx/tools/PyTIOVX/tiovx/enums.py&quot;</span>, line 62, <span class="keywordflow">in</span> &lt;module&gt;</div><div class="line">        <span class="keyword">from</span> enum <span class="keyword">import</span> Enum</div><div class="line">ImportError: No module named enum</div></div><!-- fragment --></li>
<li>See also examples in TIOVX tutorial <a href="../tutorial_guide/index.html" target="_blank">[HTML]</a> for making OpenVX usecases using PyTIOVX tool</li>
<li>See also sample python scripts (*.py) @ "&lt;tiovx install path&gt;/tools/sample_use_cases" for additional examples</li>
</ul>
<h1><a class="anchor" id="KERNEL_SCRIPT"></a>
Kernel Generation</h1>
<dl class="section user"><dt>Example Kernel Generation Python Script</dt><dd></dd></dl>
<ul>
<li>Below is an example of a Python script used for generating a custom Channel Extract kernel: <div class="fragment"><div class="line"><span class="keyword">from</span> tiovx <span class="keyword">import</span> *</div><div class="line"></div><div class="line">code = <a class="code" href="classtiovx_1_1kernel__code_1_1KernelExportCode.html">KernelExportCode</a>(Module.IMAGING, Core.C66, <span class="stringliteral">&quot;CUSTOM_APPLICATION_PATH&quot;</span>)</div><div class="line"></div><div class="line">code.setCoreDirectory(<span class="stringliteral">&quot;c66&quot;</span>)</div><div class="line"></div><div class="line">kernel = <a class="code" href="classtiovx_1_1kernel_1_1Kernel.html">Kernel</a>(<span class="stringliteral">&quot;channel_extract&quot;</span>)</div><div class="line"></div><div class="line">kernel.setParameter(Type.IMAGE, Direction.INPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;IN&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div><div class="line">kernel.setParameter(Type.ENUM, Direction.INPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;CHANNEL&quot;</span>)</div><div class="line">kernel.setParameter(Type.IMAGE, Direction.OUTPUT, ParamState.REQUIRED, <span class="stringliteral">&quot;OUT&quot;</span>, [<span class="stringliteral">&#39;VX_DF_IMAGE_U8&#39;</span>])</div><div class="line">kernel.setParameterRelationship([<span class="stringliteral">&quot;IN&quot;</span>, <span class="stringliteral">&quot;OUT&quot;</span>], [Attribute.Image.WIDTH, Attribute.Image.HEIGHT])</div><div class="line">kernel.allocateLocalMemory(<span class="stringliteral">&quot;img_scratch_mem&quot;</span>, [<span class="stringliteral">&quot;width*height&quot;</span>], <span class="stringliteral">&quot;IN&quot;</span>)</div><div class="line"></div><div class="line">kernel.setTarget(Target.DSP1)</div><div class="line">kernel.setTarget(Target.DSP2)</div><div class="line"></div><div class="line">code.export(kernel)</div></div><!-- fragment --></li>
<li>The constructor for the KernelExportCode API contains arguments that serve as the directory paths of the generated code.<ul>
<li>The first argument, Module.IMAGING, is the intended module of the kernel. A full list of modules are contained with the <a class="el" href="module_8py_source.html">module.py</a> file of PyTIOVX. If the name of the module needed is not listed, either the module can be added to the <a class="el" href="module_8py_source.html">module.py</a> file or the module name can be passed as a string to the constructor.</li>
<li>The second argument, Core.C66 is the specific core that this kernel will run on. Similar to the module name, a list of core values are listed in <a class="el" href="core_8py_source.html">core.py</a>. If the name of the core needed is not listed, either the core can be added to the <a class="el" href="core_8py_source.html">core.py</a> file or the core name can be passed as a string to the constructor.</li>
<li>The third argument "CUSTOM_APPLICATION_PATH" is the path where the output files will be exported to.<ul>
<li>Note: this path must be set as an environment variable by using "export" or else an error will be thrown.</li>
</ul>
</li>
<li>The constructor has two optional arguments, include_subpath and include_filename.<ul>
<li>The include_subpath should be set to the string value of the company name of the developer and defaults to "TI".</li>
<li>The include_filename contains the path name to the include file. By default, this value is set an empty string which results in the filepath being set to "&lt;lowercase(include_subpath)&gt;vx_&lt;module&gt;". However, the filepath can be overwritten by filling in this optional parameter.</li>
</ul>
</li>
</ul>
</li>
<li>Several dedicated API's are provided in the case that certain parameters of KernelExportCode must be changed during execution of the script. This example shows one such API, setCoreDirectory. This method can change the intended core by passing in a particular core as its only argument.</li>
<li>The constructor for the Kernel class contains as its only argument the name of the kernel to be created.</li>
<li>Parameters of a kernel are set via the setParameter API as in the example above. In this example, 3 parameters are set, an input image, an input scalar enum and an output image.</li>
<li>The following are arguments of the setParameter method:<ul>
<li>The first argument is the OpenVX data type of the parameter. Allowed values can be found in <a class="el" href="enums_8py_source.html">enums.py</a>.</li>
<li>The second argument is the direction of the parameter. Allowed values are Direction.INPUT or Direction.OUTPUT.</li>
<li>The third argument determines whether the parameter is required or optional. Allowed values are ParamState.REQUIRED or ParamState.OPTIONAL.</li>
<li>The fourth argument allows you to provide a name for the new parameter. This argument accepts a string value as the input. For instance, if this object is an input image, you may want to give it the argument "IN_IMAGE".</li>
<li>The fifth argument is optional and defines a set of allowed data types of the parameter. These are given as OpenVX data types as defined in the OpenVX 1.1 specification and are given as a comma separated list.</li>
<li>For further information, please refer to the API guide here <a class="el" href="group__PYTIOVX__API.html">PyTIOVX APIs</a>.</li>
</ul>
</li>
<li>After setting all parameters via the setParameter method, relationships among these parameters can be set via the setParameterRelationship method. This method is designed to ouput code in the validation callback to verify equality between certain attributes of parameters of the kernel. This validation of parameters is important in order no run-time errors of the kernel.</li>
<li>In this case, a relationship is set between the width and height of the "IN" and "OUT" parameters. This will produce code in the kernel validate callback that first queries the "IN" and "OUT" parameters for the width and height then checks for equality between the width of the "IN" parameter against the width of the "OUT" parameter in addition to checking for the equality between the height of the "IN" parameter against the height of the "OUT" parameter.</li>
<li>The allocateLocalMemory method is used to generate OpenVX code for allocating and free-ing local memory based on characteristics of existing data objects or on constant values. In this example, the allocateLocalMemory method is used to create a buffer with the name "img_scratch_mem" and is equal to the size of the width * height of the image, "IN". For further information, please refer to the API guide.</li>
<li>The list of targets for the kernel to run on can be set via the setTarget API. All possible targets that the kernel could run on should be given as arguments to this API. In this example, the target kernel is can be run on either DSP1 or DSP2 and therefore the setTarget API is called twice with each argument given. Allowed target values are given in <a class="el" href="enums_8py_source.html">enums.py</a>.</li>
<li>After setting up all parameters and targets of the kernel, the kernel wrappers can be generated by running the export method.</li>
<li>Further documentation of the API's used for kernel code generation can be found <a href="modules.html" target="_blank">here</a></li>
</ul>
<dl class="section user"><dt>Generated Kernel Code Overview</dt><dd></dd></dl>
<ul>
<li>This section describes the generated files based on the example given above.</li>
<li>Based on whether the code generation path is set to CUSTOM_APPLICATION_PATH or VISION_APPS_PATH, the kernel files are generated in different locations.</li>
<li>The files that are generated the first time only are noted. <div class="image">
<img src="custom_application_path.png" alt="custom_application_path.png"/>
</div>
 <div class="fragment"><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/DEVELOPER_TODO.txt (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/concerto_inc.mak</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/custom_tools_path.mak</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging.h (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_kernels.h (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_nodes.h (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/concerto.mak (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_kernels_imaging_target.c (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/concerto.mak (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/tivx_imaging_node_api.c (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_kernels_imaging_host.c (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/tivx_imaging_kernels.h (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/include/tivx_kernel_channel_extract.h</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/test/concerto.mak (generated first time only)</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/test/test_main.h (generated first time only)</div></div><!-- fragment --></li>
<li>If the final argument was changed to VISION_APPS_PATH, the following files are produced: <div class="image">
<img src="vision_apps_path.png" alt="vision_apps_path.png"/>
</div>
 <div class="fragment"><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/DEVELOPER_TODO.txt (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging.h (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_kernels.h (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/TI/tivx_imaging_nodes.h (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/concerto.mak (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/c66/vx_kernels_imaging_target.c (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/concerto.mak (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/tivx_imaging_node_api.c (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/host/vx_kernels_imaging_host.c (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/tivx_imaging_kernels.h (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/include/tivx_kernel_channel_extract.h</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/test/concerto.mak (generated first time only)</div><div class="line">&lt;VISION_APPS_PATH&gt;/kernels/imaging/test/test_main.h (generated first time only)</div></div><!-- fragment --></li>
<li>As noted, the majority of the generated files are only generated once per kernel module. These files contain boilerplate code needed for registering/unregistering the new kernels and node creation.</li>
<li>In the case that the module already exists, code will simply be appended to the existing files rather than duplicating any previously generated files.</li>
</ul>
<dl class="section user"><dt>Overview of Necessary Kernel Code Modifications</dt><dd></dd></dl>
<ul>
<li>In addition to the code generated by the python script, a text file called "DEVELOPER_TODO.txt" is generated that provides information regarding the changes to be made to the generated files.</li>
<li>The two files wherein most modifications will occur are the host and target kernel files. The files for the given example are listed below: <div class="fragment"><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/c66/vx_channel_extract_target.c</div><div class="line">&lt;CUSTOM_APPLICATION_PATH&gt;/kernels/imaging/host/vx_channel_extract_host.c</div></div><!-- fragment --></li>
<li>The host kernel file must be modified in the following ways:<ul>
<li>Validate callback: Additional custom parameter checking may need to be added to the validate callback. The script will generate parameter checking for attributes of parameters that are equal. Additional checking beyond the scope of the script must be entered in manually by the user. For example, in the case of a kernel with a scaled output, the validate callback should verify that the output is dimensions are scaled properly from the input. This type of check will most likely first require querying a given kernel parameter as specified by the OpenVX API designated for querying the given parameter. At this point the value can be verified against a known quantity. This step of proper validation catches errors during the verification stage and is important within the context of OpenVX to ensure no errors during execution of the graph.</li>
<li>Initialize callback: Appropriate valid region padding values must be added to the initialize callback to support the UNDEFINED border mode in the case that the data type in question is an image. These values will be determined by whether or not the generated kernel contains a region-based operation. For example, in the case that the kernel in question is a 3x3 filter, the padding for the top, bottom, left and right will all be a value of '1'. In the case that no region-based operations are performed, these values can be set to '0'.</li>
</ul>
</li>
<li>The target kernel file must be modified in the following ways:<ul>
<li>Create callback: The create callback is run once upon verification of the graph and should include allocation of any required local memory buffers as well as any one time initialization required for the kernel.</li>
<li>Delete callback: The delete callback is run upon release of the graph and should include the freeing of local memory buffers that were allocated within the create callback as well as any deinitialization of parameters that were initialized in the create callback.</li>
<li>Process callback: The process callback is run upon each execution of the graph and should include a call to the kernel process function. For example, in the case of OpenVX core kernels, the process callback contains a call to the optimized VXLIB function that performs the operation of the kernel.</li>
<li>Control callback: The control callback is run upon a user command to the kernel at run-time. It should include the processing of this user command and the operation necessary to modify the operation of the kernel.</li>
</ul>
</li>
<li>Within the generated test folder, the test_main.h and concerto allows for simple integration into the TIOVX test framework. However, the test case itself must be developed. For test case references, please refer to tiovx/conformance_tests/ </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="REFERENCES.html">User Resources</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
