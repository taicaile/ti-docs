<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TIOVX User Guide: Target Execution Model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TIOVX User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TIOVX_TARGET_EXECUTION.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Target Execution Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#TIOVX_TARGET_EXECUTION_SINGLE">FIFO run to completion per Target</a></li>
<li class="level1"><a href="#TIOVX_TARGET_EXECUTION_MULTI">Priority-Based Preemption of C7X Targets</a></li>
</ul>
</div>
<div class="textblock"><p>This section gives some insight into the implementation of the TIOVX framework with respect to how multiple workloads are dispatched to and executed on remote cores and targets.</p>
<h1><a class="anchor" id="TIOVX_TARGET_EXECUTION_SINGLE"></a>
FIFO run to completion per Target</h1>
<p>All of the targets execute workloads in FIFO order to completion. Each CPU has a dedicated IPC_RX task which forwards workloads to the appropriate TARGET task/thread to be executed. Please refer to the diagram and description below:</p>
<div class="image">
<img src="single_thread.png" alt="single_thread.png" width="60%"/>
</div>
<ul>
<li><b>IPC_RX Task:</b><ul>
<li>The OpenVX framework creates a IPC_RX task on each Core in the system. This IPC_RX task is run at highest priority, so that any OVX IPC workload request message can be immediately routed to the appropriate OpenVX target.</li>
</ul>
</li>
<li><b>OpenVX Targets:</b><ul>
<li>OpenVX has notion of "Targets", which are essentially named processing threads/tasks on a core. For more details, see <a class="el" href="TIOVX_ADD_TARGET.html#TIOVX_TARGET_EXPLANATION">Explanation of Targets in TIOVX</a></li>
<li>Each target will process requests to completion in FIFO order. A core can have N number of targets.</li>
<li>There are two reasons to have multiple targets on a core:<ul>
<li>If a core is managing multiple compute resources or HWAs, then a separate target can be created for each resource (e.g. VPAC VISS target, VPAC LDC target, etc). This architecture ensures proper resource management across requesters.</li>
<li>If the application wants priority-based access to a resource, then different targets can be used at different task priorities.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="TIOVX_TARGET_EXECUTION_MULTI"></a>
Priority-Based Preemption of C7X Targets</h1>
<p>In order to support the situation where multiple TIDL networks are needed to be run at different rates with different priorities, TIOVX supports multiple priority-based TARGETS on the C7X DSP(s). Additionally, TIDL has been instrumented to lock and unlock interrupts such that priority preemption can happen at well-defined points in the network processing to provide optimal context save/restore points and avoid otherwise costly preemption of the highly pipelined hardware. Please refer to the diagram and description below:</p>
<div class="image">
<img src="preemption.png" alt="preemption.png" width="70%"/>
</div>
<ul>
<li><b>Assumption</b><ul>
<li>RTOS supports and is configured to have tasks running at different priorities</li>
</ul>
</li>
<li><b>OpenVX Targets</b><ul>
<li>The application can assign each OVX DNN node to a specific target at initialization time.</li>
<li>To support multiple priorities of DNN execution with preemption, we just create multiple OVX targets on the DSP with different task priorities so that the OS can preempt and manage the priority scheme for us.</li>
<li>User just has to assign nodes to targets based on priority<ul>
<li>e.g. <a class="elRef" doxygen="/home/dockeruser/psdk_installer_build_top_workarea/scratch_workarea/staging_area/tiovx/tiovx_dev/internal_docs/doxy_cfg_user_guide/openvx.tag:https://www.khronos.org/registry/OpenVX/specs/1.1/html/" href="https://www.khronos.org/registry/OpenVX/specs/1.1/html/d7/d61/group__group__node.html#ga7409f4d86e22259caae9c0d42b18cbd9">vxSetNodeTarget</a> (node, <a class="el" href="group__group__tivx__ext__targets.html#gaa7fbdaa6e71c85babd66dfb24bfc52b4">TIVX_TARGET_DSP_C7_1_PRI_1</a> );</li>
</ul>
</li>
</ul>
</li>
<li><b>Critical Sections</b><ul>
<li>Since we need to control when the DNNs can be preempted, the DNN execution will call critical section callbacks provided by the OpenVX DNN node wrapper, disabling/reenabling interrupts to prevent the OS from preemption at wrong time.</li>
</ul>
</li>
<li><b>Deactivate/Activate</b><ul>
<li>Global variables are used to keep track of ACTIVE DNN handle, so that each DNN task, upon entering its critical section, checks if the CURRENT handle matches the ACTIVE handle. If not, it first deactivates ACTIVE handle and activates the CURRENT handle, and then updates the ACTIVE handle variable. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="REFERENCES.html">User Resources</a></li><li class="navelem"><a class="el" href="TIOVX_USAGE.html">TIOVX Usage</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
