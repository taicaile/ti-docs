<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Vision Apps User Guide: File Descriptor Exchange across Processes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vision Apps User Guide
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group_apps_basic_demos_app_arm_fd_exchange.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">File Descriptor Exchange across Processes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md65">Introduction</a></li>
<li class="level1"><a href="#autotoc_md66">Supported plaforms</a></li>
<li class="level1"><a href="#autotoc_md67">Steps to run the application on J7 EVM (Linux + RTOS mode)</a></li>
<li class="level1"><a href="#autotoc_md68">Steps to run the application on J7 EVM (QNX + RTOS mode)</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md65"></a>
Introduction</h1>
<p>This application demonstrates mechanism by which memory buffers could be exchanged across different processes for achieving zero-copy semantics. This is important for the applications where copying massive amounts of data is not an option when data producers and consumers span multiple processes.</p>
<p>The following is the sequence of operations that happen in this demo.</p>
<p>NOTE: UNIX sockets have been specifially chosen as the IPC mechanism between the processes since it is the only way one can exchange the file descriptors across processes under linux (the message format has specific control fields that aid in passing the information through the linux kernel for the fd translation).</p>
<ol type="1">
<li>A process producing the data, Producer, is instantiated. This process starts a UNIX socket based server and waits for client connections. This is an iterative server and accepts only one client connection. This process must be the first one to start, otherwise, the Consumer process will fail during its connection attempt.</li>
<li>A process consuming the data, Consumer, is instantiated. This process initiates a client connection with the Producer process.</li>
<li>The Producer sends a HELLO CMD and waits for HELLO RSP from the Consumer. This is just a basic check. In practical applications, such an exchange could be used to piggy back any Producer/Consumer capability information (ex:- sensor information). In this demo it is just a customary greeting exchange.</li>
<li>The Producer allocates a predefined number of vxImage objects, exports the handles and meta information, translates the exported handles to file descriptors to be sent over to the Consumer process.</li>
<li>The Producer sends the vxImage meta information together with the file descriptors using the UNIX sockets. Since there are multiple objects to be transferred, the Producer need to inform the Consumer when to stop looking for the incoming object information. For this, the message carries a 'lastObject' flag to indicate if the current message is the last one of its kind carrying the object information. The Producer also writes a small pattern into the exported buffers. The pattern is generated using an identical computation from a seed. This computation and seed is known to both the Producer and Consumer processes.</li>
<li>When the Consumer receives the message indicating object information, it extracts the file descriptors, decodes the meta information, creates a vxImage object, translates the file descriptor into virtual addresses (also called handles) and imports the handles into the newly created vxImage objects. The consumer verifies the pattern in the received buffers and flags if there is a mismatch.</li>
<li>Once the object exchange is complete, both sides will have two objects pointing to the same memory. Additional messages could be developed to exchange the exact buffer details based on the need. For example, when the Producer has written data to Object 'N', it can send the value 'N' over to the Consumer to inform that the data corresponding to object 'N' has been updated and is ready to be consumed. Once the Consumer is done consuming the data from object 'N', it can send a message back to the Producer saying thet the Producer can use object 'N' again.</li>
<li>This demo ends after the object exchange is done and both sides go ahead and release the vxImage objects.</li>
</ol>
<h1><a class="anchor" id="autotoc_md66"></a>
Supported plaforms</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform  </th><th class="markdownTableHeadNone">Linux x86_64  </th><th class="markdownTableHeadNone">Linux+RTOS mode  </th><th class="markdownTableHeadNone">QNX+RTOS mode  </th><th class="markdownTableHeadNone">SoC   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Support  </td><td class="markdownTableBodyNone">NO  </td><td class="markdownTableBodyNone">YES  </td><td class="markdownTableBodyNone">YES  </td><td class="markdownTableBodyNone">J721e / J721S2 / J784S4   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md67"></a>
Steps to run the application on J7 EVM (Linux + RTOS mode)</h1>
<ol type="1">
<li>Build the application and related libraries as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></li>
<li>Run the init script as shown below <div class="fragment"><div class="line">cd /opt/vision_apps</div><div class="line">source ./vision_apps_init.sh</div></div><!-- fragment --></li>
<li>Run the Producer executable. You can provide an optional command line option '-v' to see INFO messages. The command below puts the process in the background. This is only needed if the Consumer process is going to be launched in the same shell. <div class="fragment"><div class="line">./vx_app_arm_fd_exchange_producer.out &amp;</div></div><!-- fragment --></li>
<li>Run the Consumer executable. You can provide an optional command line option '-v' to see INFO messages <div class="fragment"><div class="line">./vx_app_arm_fd_exchange_consumer.out</div></div><!-- fragment --></li>
<li>If all goes well, there should be no ERROR messages on the screen</li>
</ol>
<h1><a class="anchor" id="autotoc_md68"></a>
Steps to run the application on J7 EVM (QNX + RTOS mode)</h1>
<ol type="1">
<li>Build the application and related libraries as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></li>
<li>Run the init script as shown below <div class="fragment"><div class="line">cd /ti_fs/vision_apps</div><div class="line">. ./vision_apps_init.sh</div></div><!-- fragment --></li>
<li>Run the Producer executable. You can provide an optional command line option '-v' to see INFO messages. The command below puts the process in the background. This is only needed if the Consumer process is going to be launched in the same shell. <div class="fragment"><div class="line">./vx_app_arm_fd_exchange_producer.out &amp;</div></div><!-- fragment --></li>
<li>Run the Consumer executable. You can provide an optional command line option '-v' to see INFO messages <div class="fragment"><div class="line">./vx_app_arm_fd_exchange_consumer.out</div></div><!-- fragment --></li>
<li>If all goes well, there should be no ERROR messages on the screen </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
