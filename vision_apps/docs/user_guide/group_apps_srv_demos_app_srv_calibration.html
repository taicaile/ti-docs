<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Vision Apps User Guide: Surround View Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vision Apps User Guide
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group_apps_srv_demos_app_srv_calibration.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Surround View Calibration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md168">Introduction</a></li>
<li class="level1"><a href="#autotoc_md169">Supported plaforms</a></li>
<li class="level1"><a href="#autotoc_md170">Data flow</a></li>
<li class="level1"><a href="#autotoc_md171">Steps to run the application on J7 EVM</a></li>
<li class="level1"><a href="#autotoc_md172">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md168"></a>
Introduction</h1>
<p>This application allows users to generate the necessary calibration file (CALMAT.BIN) for running the 3D Surround View application. This application also allows users to capture raw and YUV images from the individual sensors.</p>
<h1><a class="anchor" id="autotoc_md169"></a>
Supported plaforms</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform  </th><th class="markdownTableHeadNone">Linux x86_64  </th><th class="markdownTableHeadNone">Linux+RTOS mode  </th><th class="markdownTableHeadNone">QNX+RTOS mode  </th><th class="markdownTableHeadNone">SoC   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Support  </td><td class="markdownTableBodyNone">NO  </td><td class="markdownTableBodyNone">YES  </td><td class="markdownTableBodyNone">YES  </td><td class="markdownTableBodyNone">J721e / J721S2 / J784S4   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md170"></a>
Data flow</h1>
<p>The Surround View Calibration app contains multiple separate graphs. The first graph contains the mosaic visualization, capturing using the capture node, giving the raw output to the VISS and AEWB nodes to perform the image processing. The output of the VISS is then given to the mosaic node to perform a four channel mosaic of the input images. The output from the mosaic is dequeued from the first graph and the overlays are draw on the image before giving it to the second graph. The second graph contains only the display node. The final graph contains the SRV calibration nodes. The input to this graph comes from the VISS output from the second graph and contains the point detection and pose estimation nodes running on the DSP. The output from this graph is the CALMAT.BIN file used for calibrating SRV.</p>
<div class="image">
<img src="vx_app_srv_calibration_data_flow.png" alt="vx_app_srv_calibration_data_flow.png"/>
</div>
<h1><a class="anchor" id="autotoc_md171"></a>
Steps to run the application on J7 EVM</h1>
<ol type="1">
<li>Build the application and related libraries as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></li>
<li>Follow steps 1-3 as mentioned in <a class="el" href="RUN_INSTRUCTIONS.html">Run Instructions</a><ol type="a">
<li>Important note: be sure to extract all test data to SD card or else the demo won't run</li>
</ol>
</li>
<li>The input files come from "${VX_TEST_DATA_PATH}/test_data/psdkra/srv/srv_app/"</li>
<li>In order to run this app, the LENS.BIN and CHARTPOS.BIN files must be present in this path. The default files are present in the release package. Otherwise, these files can be generated by using the manual calibration tool. The manual calibration tool can be found <a href="./PSDK_RTOS_UserGuide_3D_SurroundView_Manual_CalibTool.pdf" target="_blank">here</a>.</li>
<li>In Linux+RTOS or QNX+RTOS mode<ol type="a">
<li>Setup requirements:<ol type="i">
<li>Connect 4 D3-IMX390 (Version1-D3RCM) sensor boards on cam0-cam3 input port of the Fusion1 Platform, as shown in the above image. (Note: these are the only sensors that have been tested with the SRV demo). Please ensure that the power to the Fusion1 Platform is connected.</li>
<li>The four cameras must be connected in the order front, right, back, left to cam0, cam1, cam2, cam3 respectively.</li>
<li>The cameras such that each camera can view two black squares from the calibration chart seen <a href="./poster_calib_chart.pdf" target="_blank">here</a> within the blue bounding boxes on the display. The calibration chart must be printed on a 36"x48" poster.</li>
<li>Either an eDP display or HDMI display with infotainment daughter card must be connected to the EVM in order to visualize the Surround View output. Note: the display type is chosen via a build option as described in Step 3 of <a class="el" href="RUN_INSTRUCTIONS.html">Run Instructions</a></li>
</ol>
</li>
<li>VX_TEST_DATA_PATH environment variable is set as part of vision_apps_init.sh</li>
<li>Run the app as shown below on the J7 EVM target <div class="fragment"><div class="line">cd /opt/vision_apps</div><div class="line">source ./vision_apps_init.sh</div><div class="line">./vx_app_srv_calibration.out</div></div><!-- fragment --></li>
<li>After running this app, a four channel mosaic will be shown on the display. Additionally, overlay boxes will be seen in each quadrant. Finally, a menu of options will appear listing the various actions that can be taken.<ol type="i">
<li>The first option is the run the calibration. In order for calibration to be successful, the calibration chart boxes for each camera fall within the bounding box region. After selecting option "a", the calibration will run and give a status of whether it is successful or not. If the calibration is successful, red boxes will appear on the locations of the detected corners of the calibration chart boxes. The image will then freeze to show exactly where on the chart that these corners were detected. If the red boxes do not line up to where the corners are on the chart, the graph can resume streaming by selecting "c". If the calibration is not successful, the console will indicate that it has failed and the video will continue to stream. Calibration can be re-run by adjusting the cameras accordingly and re-selecting "a".</li>
<li>Option "b" allows the user to dump the VISS output images. These images will be dumped in the folder /opt/vision_apps/test_data/output/viss_output_*.yuv, based on the camera (front, back, left, right). These images can be used as input to the manual calibration tool.</li>
<li>Option "c" allows calibration to be re-run in the case that the corners are not detected correctly, as mentioned above.</li>
<li>Option "d" dumps the raw output from the camera in the location opt/vision_apps/test_data/output/capture_output_*.raw, based on the camera (front, back, left, right).</li>
</ol>
</li>
<li>After selecting option "a" to calibrate, the output calibration table will be dumped at the location "${VX_TEST_DATA_PATH}/test_data/psdkra/srv/srv_app/CALMAT.BIN". This file can be used to run the <a class="el" href="group_apps_srv_demos_app_srv_camera.html">3D Surround View Application</a> demo.</li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md172"></a>
Sample Output</h1>
<p>Shown below is a sample image of the output of the Surround View Calibration application</p>
<div class="image">
<img src="app_srv_calibration_output.jpg" alt="app_srv_calibration_output.jpg"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
