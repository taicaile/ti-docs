<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Vision Apps User Guide: Run Instructions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vision Apps User Guide
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('RUN_INSTRUCTIONS.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Run Instructions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md11">IMPORTANT NOTES</a></li>
<li class="level1"><a href="#run_steps_linux">Run vision apps on EVM in Linux+RTOS mode (via SD card boot)</a><ul><li class="level2"><a href="#run_step1_linux">Step 1: Prepare SD card for boot (one time only)</a></li>
<li class="level2"><a href="#run_step_copy_test_data_linux">Step 2: Copy test data to SD card (one time only)</a></li>
<li class="level2"><a href="#run_step_copy_files_linux">Step 3: Copy executable files to SD card (first time and each time you want to run updated applications)</a></li>
<li class="level2"><a href="#run_step_run_on_evm_linux">Step 4: Run on EVM</a></li>
<li class="level2"><a href="#autotoc_md12">Sample logs</a></li>
</ul>
</li>
<li class="level1"><a href="#run_steps_linux_nfs">Run vision apps on EVM in Linux+RTOS mode (via NFS boot - For Debug only)</a></li>
<li class="level1"><a href="#run_steps_qnx">Run vision apps on EVM in QNX+RTOS mode (via SD card boot)</a><ul><li class="level2"><a href="#run_step1_qnx">Step 1: Prepare SD card for boot (one time only)</a></li>
<li class="level2"><a href="#run_step_copy_files_qnx_a">Step 2a: Copy executable files to SD card for boot using SPL+Uboot(first time and each time you want to run updated applications)</a></li>
<li class="level2"><a href="#run_step_copy_files_qnx_b">Step 2b: Copy executable files to SD card for boot using MMCSD+SBL(first time and each time you want to run updated applications)</a></li>
<li class="level2"><a href="#run_step_copy_files_qnx_c">Step 2c: Copy executable files to SD card for boot using OSPI+SBL(first time and each time you want to run updated applications)</a></li>
<li class="level2"><a href="#run_step_copy_test_data_qnx">Step 3: Copy test data to SD card (one time only)</a></li>
<li class="level2"><a href="#run_step_run_on_evm_qnx">Step 4: Run on EVM</a></li>
</ul>
</li>
<li class="level1"><a href="#run_in_pc_mode">Run vision apps on PC in PC emulation mode</a><ul><li class="level2"><a href="#build_instruction_sec3">Running the TIOVX demos in PC emulation mode</a></li>
<li class="level2"><a href="#build_instruction_sec4">Running the vision apps demos in PC emulation mode</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md11"></a>
IMPORTANT NOTES</h1>
<ul>
<li><b> Make sure additional components and network proxies are setup as mentioned in <a class="el" href="ENVIRONMENT_SETUP.html">Build Environment Setup</a> before proceeding to building PSDK RTOS </b></li>
<li><b> Make sure you dont skip any of the steps mentioned below </b></li>
<li>${PSDKR_PATH} refers to the path where Processor SDK RTOS (PSDK RTOS) is installed</li>
<li>${PSDKL_PATH} refers to the path where Processor SDK Linux (PSDK Linux) is installed</li>
<li>All folders like, pdk, tiovx, vision_apps mentioned in the user guide are relative to ${PSDKR_PATH} unless explicitly stated otherwise.</li>
<li>The build is tested on Ubuntu (x86_64) 22.04 system and may not work on earlier or later Ubuntu systems.</li>
<li>20GB of free space is required to install and build PSDK RTOS</li>
<li>Make sure you have sudo access</li>
<li>If a demo is enabled for both target and emulation mode, there will be 2 different configuration files, one for target execution and one for host emulation.<ul>
<li>These can be found in the paths below:<ul>
<li>Target Exeuction: apps/basic_demos/app_linux_fs_files/&lt;app_config&gt;.cfg</li>
<li>Host Emulation: apps/basic_demos/&lt;app_name&gt;/&lt;app_config&gt;.cfg</li>
</ul>
</li>
<li>If one wants to modify the configuration for target execution, there are two options:<ul>
<li>One can modify the config file on the SD card directly. However the config file will get overwritten with the original one when 'make linux_fs_install_sd' is called.</li>
<li>One can modify the original file in ./apps/basic_demos/app_linux_fs_files/&lt;app_config&gt;.cfg and then invoke 'make linux_fs_install_sd'</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="run_steps_linux"></a>
Run vision apps on EVM in Linux+RTOS mode (via SD card boot)</h1>
<dl class="section note"><dt>Note</dt><dd>make sure vision_apps is built for Linux+RTOS mode as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></dd></dl>
<h2><a class="anchor" id="run_step1_linux"></a>
Step 1: Prepare SD card for boot (one time only)</h2>
<dl class="section warning"><dt>Warning</dt><dd>ALL contents of SD card will be lost when doing these steps.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li>Insert SD card onto your PC SD card slot and format SD card in two partitions,<ul>
<li>FAT32 partition: for boot loader, 64MB size recommended</li>
<li>ext4 partition: for root filesystem, rest of SD card, at least 32GB SD card recommended.</li>
</ul>
</li>
<li>You can use one of two options to format your SD card<ul>
<li><b>Option 1:</b> You can use the utility script <b>sdk_builder/scripts/mk-linux-card.sh</b> to make the partitions<ul>
<li>Use the command "df -h" to identify the device used by SD card</li>
<li>Unmount the SD card before running the script<ul>
<li>Example, if your SD card is on device /dev/sdb having two partitions, do below to unmount them <div class="fragment"><div class="line">umount /dev/sdb1</div><div class="line">umount /dev/sdb2</div></div><!-- fragment --></li>
<li>Run the script as below to partition it, answer "y" to all questions asked when running the script <div class="fragment"><div class="line">cd ${PSDKR_PATH}</div><div class="line">sudo sdk_builder/scripts/mk-linux-card.sh /dev/sdb</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Make sure to give the correct device name to this script, example /dev/sda is typically local harddisk, if you give this by mistake, your whole hard disk will be wiped off !!!</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 2:</b> you can use "gparted" utility (sudo apt install gparted) to use a GUI based interface to create the partitions.<ul>
<li>Make sure you set the FAT32 partition flags as "boot", "lba"</li>
<li>Name the FAT32 partition as "BOOT" and the ext4 partition as "rootfs"</li>
</ul>
</li>
</ul>
</li>
<li>After formatting, remove and insert the SD card for the freshly formatted partitions to get auto mounted on the host PC.</li>
<li>Copy/untar filesystem and boot files to SD card by executing the script as shown below, <div class="fragment"><div class="line">cd ${PSDKR_PATH}</div><div class="line">sdk_builder/scripts/install_to_sd_card.sh</div></div><!-- fragment --></li>
<li><b>DO NOT REMOVE SD card</b>, goto step 2 to complete rest of SD card installation</li>
</ul>
<h2><a class="anchor" id="run_step_copy_test_data_linux"></a>
Step 2: Copy test data to SD card (one time only)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li><p class="startli">Untar the demo input files located in the <b>psdk_rtos_ti_data_set_xx_xx_xx.tar.gz</b> and <b>psdk_rtos_ti_data_set_xx_xx_xx_{SOC}.tar.gz</b> files to the SD card at below folder. You can find these files at the same location the PSDK RTOS installer is hosted. </p><div class="fragment"><div class="line">cd /media/$USER/rootfs/</div><div class="line">mkdir -p opt/vision_apps</div><div class="line">cd opt/vision_apps</div><div class="line">tar --strip-components=1 -xf ${path/to/file}/psdk_rtos_ti_data_set_xx_xx_xx.tar.gz</div><div class="line">tar --strip-components=1 -xf ${path/to/file}/psdk_rtos_ti_data_set_xx_xx_xx_{SOC}.tar.gz</div><div class="line">sync</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This test data is required for most of the vision apps demos, so this step is mandatory when running vision apps demos</dd></dl>
</li>
<li>After untar you should see a folder "test_data" in folder opt/vision_apps in the SD card. i.e folder in SD card should look like <div class="fragment"><div class="line">tree -L 1 -d /media/$USER/rootfs/opt/vision_apps/test_data</div><div class="line"></div><div class="line">  /media/$USER/rootfs/opt/vision_apps/test_data</div><div class="line">  ├── harriscorners</div><div class="line">  ├── output</div><div class="line">  ├── psdkra</div><div class="line">  └── tivx</div></div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="run_step_copy_files_linux"></a>
Step 3: Copy executable files to SD card (first time and each time you want to run updated applications)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li>Insert the formatted SD card onto your host PC SD card slot, (if not already inserted).</li>
<li>Do below to copy vision apps binaries to SD card <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make linux_fs_install_sd</div></div><!-- fragment --> OR if using an HS device, <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make linux_fs_install_sd HS=1</div></div><!-- fragment --></li>
<li>This also copies a file uEnv.txt to boot partition to select the .dtbo's which is required to run vision apps demos.</li>
<li>Eject and remove SD card from PC and insert in EVM</li>
</ul>
<h2><a class="anchor" id="run_step_run_on_evm_linux"></a>
Step 4: Run on EVM</h2>
<ul>
<li>Setup the EVM as shown on this page <a href="../../../psdk_rtos/docs/user_guide/evm_setup_j721s2.html">[HTML]</a><ul>
<li>Connect UART/USB cable and setup UART terminal</li>
<li>Connect daughter card for camera, display as required</li>
<li>Connect power supply</li>
<li>Connect HDMI and/or DP display</li>
<li>Select SD card boot mode on EVM</li>
<li>Insert SD card</li>
</ul>
</li>
<li>Power on the EVM</li>
<li>You should see bootloader prints on the UART terminal and then bootloader will boot linux kernel and you should see login prompt as below <div class="fragment"><div class="line">${SOC}-evm login:</div></div><!-- fragment --></li>
<li>On the EVM, Login using below user id, no password <div class="fragment"><div class="line">root</div></div><!-- fragment --></li>
<li>On the EVM, do below steps to init the environment for the demos <div class="fragment"><div class="line">cd /opt/vision_apps</div><div class="line">source ./vision_apps_init.sh</div></div><!-- fragment --></li>
<li>Now run one of the below scripts/applications to run the demos <div class="fragment"><div class="line">./run_app_tidl.sh                     - Image classification demo (needs display)</div><div class="line">./run_app_tidl_avp2.sh                - Auto valet parking demo (needs display)</div><div class="line">./run_app_dof.sh                      - Dense optical flow demo (needs display)</div><div class="line">./run_app_stereo.sh                   - Stereo disparity demo (needs display)</div><div class="line">./run_app_c7x.sh                      - C7x sample kernel demo</div><div class="line">./run_app_srv.sh                      - 3D SRV 4 camera demo (needs display, Fusion1 board, 4x IMX390 camera)</div><div class="line">./run_app_single_cam.sh               - Single camera + VISS + Display demo (needs display, Fusion1 board, 1x IMX390 or compatible camera&#39;s)</div><div class="line">./run_app_multi_cam.sh                - Multi (4x) camera + VISS + Display demo (needs display, Fusion1 board, 4x IMX390 or compatible camera&#39;s)</div><div class="line">./vx_app_arm_opengl_mosaic.out        - OpenGL + OpenVX test</div><div class="line">./vx_app_linux_arm_ipc.out            - inter processor communication test</div><div class="line">./vx_app_linux_arm_mem.out            - memory allocation test</div><div class="line">./vx_app_tutorial.out                 - TI OpenVX tutorial</div><div class="line">./vx_app_conformance.out              - TI OpenVX conformance tests</div></div><!-- fragment --></li>
<li>Once the demo runs, you should see output on the display<ul>
<li>Display can be eDP or HDMI as selected via <a class="el" href="BUILD_INSTRUCTIONS.html#MAKEFILE_OPTIONS">Makefile and configuration options</a></li>
</ul>
</li>
<li>Type 'x' to exit the demo and run another demo</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Sample logs</h2>
<ul>
<li>Sample logs during EVM boot can be found here <a href="../logs/boot_log.txt" target="_blank">[TXT]</a></li>
<li>Sample logs during vision_apps_init.sh can be found here <a href="../logs/vision_app_init_log.txt" target="_blank">[TXT]</a></li>
</ul>
<h1><a class="anchor" id="run_steps_linux_nfs"></a>
Run vision apps on EVM in Linux+RTOS mode (via NFS boot - For Debug only)</h1>
<dl class="section note"><dt>Note</dt><dd>make sure vision_apps is built for Linux+RTOS mode as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a> </dd>
<dd>
make sure that you have sd card set up at least once as mentioned above</dd></dl>
<ul>
<li>Setup NFS according PSDK Linux documentation<ul>
<li>This is done by executing the ./setup.sh script in the folder "ti-processor-sdk-linux-adas-&lt;board-name&gt;-&lt;ver-num&gt;"<ul>
<li>Use all default options with two possible exceptions.<ul>
<li>If you are connected to a VPN, setup.sh will sometimes detect two IP addresses and present both at once as the default option. Be sure to only enter the local IP address (likely begins with 192.168.x.x)</li>
<li>The serial port that you would like to use is usually not /dev/ttyS0, choose /dev/ttyUSB0 if only one EVM is connected to the host Linux machine.</li>
</ul>
</li>
<li>Exit the script without connecting to the EVM (it will try to auto-connect at the end of the script)</li>
</ul>
</li>
<li>After running setup.sh, the following should be on your host Linux machine:<ol type="1">
<li>A target folder named "ti-processor-sdk-linux-adas-&lt;board-name&gt;-&lt;ver-num&gt;/targetNFS" (or something similar if you changed the file path in ./setup.sh) populated with the root filesystem.</li>
<li>The folder above listed in /etc/exports</li>
<li>A folder named /tftpboot populated with kernels and dtb files.</li>
<li>A file in "ti-processor-sdk-linux-adas-&lt;board-name&gt;-&lt;ver-num&gt;/bin/setupBoard.minicom"</li>
</ol>
</li>
</ul>
</li>
<li>Insert SD Card (for NFS, the boot partition in SD card is still required)<ul>
<li>Do not power on EVM yet.</li>
</ul>
</li>
<li>Run the command from "ti-processor-sdk-linux-adas-&lt;board-name&gt;-&lt;ver-num&gt;" <div class="fragment"><div class="line">sudo minicom -S ./bin/setupBoard.minicom</div></div><!-- fragment --></li>
<li>Power on the EVM<ul>
<li>The minicom script will populate u-boot with new environment variables</li>
<li>Once the script begins to load the kernel, interrupt the process with Ctrl-C<ul>
<li>Note: it is okay if the kernel finishes loading - you can also just power cycle the board and stop the boot process at the u-boot prompt by pressing any key. Previously declared u-boot parameters have been saved with "saveenv" command.</li>
</ul>
</li>
</ul>
</li>
<li>Once you have a u-boot terminal again ( "=&gt;" ), enter the following commands:<ul>
<li>Note: the first command is the only one which requires manually input data (Linux host machine IP address). All of the following commands can be copy-pasted directly into the u-boot prompt. <div class="fragment"><div class="line">setenv serverip_to_set &lt;your_host_ip_address&gt;</div><div class="line">setenv serverip ${serverip_to_set}</div><div class="line">setenv init_net &#39;run args_all args_net; setenv autoload no;dhcp; setenv serverip ${serverip_to_set};rproc init; run boot_rprocs_mmc; rproc list;&#39;</div><div class="line">setenv rproc_fw_binaries &#39;2 /lib/firmware/j721s2-main-r5f0_0-fw 3 /lib/firmware/j721s2-main-r5f0_1-fw 6 /lib/firmware/j721s2-c71_0-fw 7 /lib/firmware/j721s2-c71_1-fw&#39;</div><div class="line">setenv rproc_load_and_boot_one &#39;if nfs $loadaddr ${serverip}:${nfs_root}/${rproc_fw};then if rproc load ${rproc_id} ${loadaddr} ${filesize}; then rproc start ${rproc_id};fi;fi&#39;</div><div class="line">setenv overlay_files &#39;k3-j721s2-vision-apps.dtbo&#39;</div><div class="line">setenv overlayaddr ${dtboaddr}</div><div class="line">setenv args_net &#39;setenv bootargs console=${console} ${optargs} rootfstype=nfs root=/dev/nfs rw nfsroot=${serverip}:${nfs_root},${nfs_options} ip=dhcp&#39;</div><div class="line">setenv setup_net &#39;setenv autoload no; dhcp; setenv serverip ${serverip_to_set}&#39;</div><div class="line">saveenv</div><div class="line">boot</div></div><!-- fragment --></li>
</ul>
</li>
<li>To change between nfs and mmc boot:<ul>
<li>For NFS boot: <div class="fragment"><div class="line">setenv rproc_load_and_boot_one &#39;if nfs $loadaddr ${serverip}:${rootpath}${rproc_fw};then if rproc load ${rproc_id} ${loadaddr} ${filesize}; then rproc start ${rproc_id};fi;fi&#39;</div><div class="line">setenv boot nfs</div></div><!-- fragment --></li>
<li>For MMC boot: <div class="fragment"><div class="line">setenv rproc_load_and_boot_one &#39;if load mmc ${bootpart} $loadaddr ${rproc_fw}; then if rproc load ${rproc_id} ${loadaddr} ${filesize}; then rproc start ${rproc_id};fi;fi&#39;</div><div class="line">setenv boot mmc</div></div><!-- fragment --></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="run_steps_qnx"></a>
Run vision apps on EVM in QNX+RTOS mode (via SD card boot)</h1>
<dl class="section note"><dt>Note</dt><dd>make sure vision_apps is built for QNX+RTOS mode as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></dd></dl>
<h2><a class="anchor" id="run_step1_qnx"></a>
Step 1: Prepare SD card for boot (one time only)</h2>
<dl class="section warning"><dt>Warning</dt><dd>ALL contents of SD card will be lost when doing these steps.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC </dd>
<dd>
There are two versions of the J721e EVM, alpha, beta. The uboot detects the EVM version and chooses the right config for the EVM version.</dd></dl>
<ul>
<li>Insert SD card onto your PC SD card slot and format SD card in three partitions. At least 16GB SD card recommended<ul>
<li>FAT32 partition: for boot files, 128MB size recommended.</li>
<li>ext4 partition: for remote core firmwares and root filesystem, 1GB size recommended.</li>
<li>FAT32 partition: for QNX filesystem, More than 12GB recommended.</li>
</ul>
</li>
<li>You can use one of two options to format your SD card<ul>
<li><b>Option 1:</b> You can use the utility script <b>sdk_builder/scripts/mk-qnx-card.sh</b> to make the partitions<ul>
<li>Use the command "df -h" to identify the device used by SD card</li>
<li>Unmount the SD card before running the script<ul>
<li>Example, if your SD card is on device /dev/sdb having three partitions, do below to unmount them <div class="fragment"><div class="line">umount /dev/sdb1</div><div class="line">umount /dev/sdb2</div><div class="line">umount /dev/sdb3</div></div><!-- fragment --></li>
<li>Run the script as below to partition it, answer "y" to all questions asked when running the script <div class="fragment"><div class="line">cd ${PSDKR_PATH}</div><div class="line">sudo sdk_builder/scripts/mk-qnx-card.sh --device /dev/sdb</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Make sure to give the correct device name to this script, example /dev/sda is typically local harddisk, if you give this by mistake, your whole hard disk will be wiped off !!!</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
<li><b>Option 2:</b> you can use "gparted" utility (sudo apt install gparted) to use a GUI based interface to create the partitions.<ul>
<li>Make sure you set the first FAT32 partition name as "boot", flag as "lba". Size of 128MB recommended.</li>
<li>Make the second partition as EXT4 partition and name as "rootfs". Size of 1GB recommended.</li>
<li>Name the third FAT32 partition as "qnxfs". Size of &gt;12GB recommended.</li>
</ul>
</li>
</ul>
</li>
<li>After formatting, remove and insert the SD card for the freshly formatted partitions to get auto mounted on the host PC.</li>
<li><p class="startli">Copy the QNX filesystem and binaries to SD card by executing the command in vision_apps folder, </p><div class="fragment"><div class="line">make qnx_fs_create_sd</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Above command builds the QNX BSP+filesystem and copies it to the SD card</dd></dl>
</li>
<li><b>DO NOT REMOVE SD card</b>, goto step 2 to complete rest of SD card installation</li>
</ul>
<h2><a class="anchor" id="run_step_copy_files_qnx_a"></a>
Step 2a: Copy executable files to SD card for boot using SPL+Uboot(first time and each time you want to run updated applications)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li>Insert the formatted SD card onto your host PC SD card slot, (if not already inserted).</li>
<li>Do below to copy the binaries to SD card <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make qnx_fs_install_sd</div></div><!-- fragment --></li>
<li><b>DO NOT REMOVE SD card</b>, goto step 3 to complete rest of SD card installation</li>
</ul>
<h2><a class="anchor" id="run_step_copy_files_qnx_b"></a>
Step 2b: Copy executable files to SD card for boot using MMCSD+SBL(first time and each time you want to run updated applications)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li>Ensure all steps have been followed from the page <a class="el" href="BUILD_INSTRUCTIONS.html#QUICK_SETUP_STEPS_QNX_TI_RTOS">QNX+RTOS mode</a>.</li>
<li>Insert the formatted SD card onto your host PC SD card slot, (if not already inserted).</li>
<li>Depending on whether you have a GP or HS device, you will need to use one of the following commands to copy to the SD card:<ul>
<li><b>Option 1:</b> If using a GP device, do below to copy the binaries to SD card <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make qnx_fs_install_sd_sbl</div></div><!-- fragment --></li>
<li><b>Option 2:</b> If using an HS device, do below to copy the binaries to SD card <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make qnx_fs_install_sd_sbl_hs</div></div><!-- fragment --></li>
</ul>
</li>
<li><b>DO NOT REMOVE SD card</b>, goto step 3 to complete rest of SD card installation</li>
</ul>
<h2><a class="anchor" id="run_step_copy_files_qnx_c"></a>
Step 2c: Copy executable files to SD card for boot using OSPI+SBL(first time and each time you want to run updated applications)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li>Ensure all steps have been followed from the page <a class="el" href="BUILD_INSTRUCTIONS.html#QUICK_SETUP_STEPS_QNX_TI_RTOS">QNX+RTOS mode</a>.</li>
<li>Insert the formatted SD card onto your host PC SD card slot, (if not already inserted). This is for copying the vision apps binaries only.</li>
<li>To flash boot binaries to the OSPI flash, you need to have Uniflash flashprogrammer installed in the host PC. If you don't have this, install it from <a href="http://www.ti.com/tool/UNIFLASH">[UNIFLASH]</a></li>
<li>Make sure that the MCU UART is connected to the host PC. Note the port name of the second COM PORT of the MCU UART. You can find this using "dmesg | grep ttyUSB" in linux. For example let's assume it was '/dev/ttyUSB1'</li>
<li>Edit file sdk_builder/makerules/makefile_sbl,mk for below variables based on your system environment <div class="fragment"><div class="line">UNIFLASH_DIR=${HOME}/ti/$(UNIFLASH_VERSION)  # this is the default install dir</div><div class="line">UNIFLASH_COM_PORT=/dev/ttyUSB1 # this must be the second MCU_UART port on the EVM</div></div><!-- fragment --></li>
<li>Ensure your EVM is in UART boot mode. Please refer to the following link for how to set the EVM to UART boot mode <a href="../../../psdk_rtos/docs/user_guide/evm_setup_j721s2.html">[HTML]</a>.</li>
<li>Flash boot files, vision_apps binaries for R5F, C6x, C7x and QNX kernel, rootfs to OSPI flash. This also copies QNX MPU applications to SD card. <dl class="section note"><dt>Note</dt><dd>Make sure EVM is in UART boot mode and make sure MCU UART terminal is not open since UNIFLASH needs to use this UART device <div class="fragment"><div class="line">cd ${PSDKR_PATH}/sdk_builder</div><div class="line">make qnx_fs_install_ospi</div></div><!-- fragment --></dd></dl>
</li>
<li>Connect the UART cable back to the standard UART connection from the MCU UART connection</li>
<li>Modify the EVM switch settings to OSPI boot mode. Please refer to the following link for how to set the EVM to OSPI boot mode <a href="../../../psdk_rtos/docs/user_guide/evm_setup_j721s2.html">[HTML]</a>.</li>
<li><b>DO NOT REMOVE SD card</b>, goto step 3 to complete rest of SD card installation</li>
</ul>
<h2><a class="anchor" id="run_step_copy_test_data_qnx"></a>
Step 3: Copy test data to SD card (one time only)</h2>
<dl class="section note"><dt>Note</dt><dd>Run below commands on host PC</dd></dl>
<ul>
<li><p class="startli">Untar the demo input files located in the <b>psdk_rtos_ti_data_set_xx_xx_xx.tar.gz</b> and <b>psdk_rtos_ti_data_set_xx_xx_xx_{SOC}.tar.gz</b> files to the SD card at below folder. You can find this file at the same location the PSDK RTOS installer is hosted. </p><div class="fragment"><div class="line">cd /media/$USER/qnxfs/</div><div class="line">mkdir -p vision_apps</div><div class="line">cd vision_apps</div><div class="line">tar --strip-components=1 -xf ${path/to/file}/psdk_rtos_ti_data_set_xx_xx_xx.tar.gz</div><div class="line">tar --strip-components=1 -xf ${path/to/file}/psdk_rtos_ti_data_set_xx_xx_xx_{SOC}.tar.gz</div><div class="line">sync</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This test data is required for most of the vision apps demos, so this step is mandatory when running vision apps demos</dd></dl>
</li>
<li>After untar you should see a folder "test_data" in folder vision_apps in the SD card. i.e folder in SD card should look like <div class="fragment"><div class="line">tree -L 1 -d /media/$USER/qnxfs/vision_apps/test_data</div><div class="line"></div><div class="line">  /media/$USER/qnxfs/vision_apps/test_data</div><div class="line">  ├── harriscorners</div><div class="line">  ├── output</div><div class="line">  ├── psdkra</div><div class="line">  └── tivx</div></div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="run_step_run_on_evm_qnx"></a>
Step 4: Run on EVM</h2>
<ul>
<li>Setup the EVM as shown on this page <a href="../../../psdk_rtos/docs/user_guide/evm_setup_j721s2.html">[HTML]</a><ul>
<li>Connect UART/USB cable and setup UART terminal</li>
<li>Connect daughter card for camera, display as required</li>
<li>Connect power supply</li>
<li>Connect HDMI and/or DP display</li>
<li>If you're using SPL+Uboot or SBL-MMCSD boot, select SD card boot mode on EVM. If you're using the SBL-OSPI boot, select the OSPI boot mode on the EVM.</li>
<li>Insert SD card</li>
</ul>
</li>
<li>Power on the EVM</li>
<li>You should see bootloader prints on the UART terminal. This can be the MCU UART terminal if the boot is MMCSD or OSPI based, or the MAIN UART Terminal if SPL+Uboot based.</li>
<li>The bootloader will boot QNX kernel and you should see QNX prompt in the first port of MAIN UART as below <div class="fragment"><div class="line">J7EVM@QNX#</div></div><!-- fragment --></li>
<li>On the EVM, do below steps to init the environment for the demos <div class="fragment"><div class="line">cd /ti_fs/vision_apps</div><div class="line">. ./vision_apps_init.sh (source)</div></div><!-- fragment --></li>
<li>Now run one of the below scripts/applications to run the demos <div class="fragment"><div class="line">./run_app_tidl.sh                     - Image classification demo (needs display)</div><div class="line">./run_app_tidl_avp2.sh                - Auto valet parking demo (needs display)</div><div class="line">./run_app_dof.sh                      - Dense optical flow demo (needs display)</div><div class="line">./run_app_c7x.sh                      - C7x sample kernel demo</div><div class="line">./run_app_srv.sh                      - 3D SRV 4 camera demo (needs display, Fusion1 board, 4x IMX390 camera)</div><div class="line">./run_app_single_cam.sh               - Single camera + VISS + Display demo (needs display, Fusion1 board, 1x IMX390 or compatible camera&#39;s)</div><div class="line">./run_app_multi_cam.sh                - Multi (4x) camera + VISS + Display demo (needs display, Fusion1 board, 4x IMX390 or compatible camera&#39;s)</div><div class="line">./vx_app_arm_opengl_mosaic.out        - OpenGL + OpenVX test</div><div class="line">./vx_app_linux_arm_ipc.out            - inter processor communication test</div><div class="line">./vx_app_linux_arm_mem.out            - memory allocation test</div><div class="line">./vx_app_tutorial.out                 - TI OpenVX tutorial</div><div class="line">./vx_app_conformance.out              - TI OpenVX conformance tests</div></div><!-- fragment --></li>
<li>Once the demo runs, you should see output on the display<ul>
<li>Display can be eDP or HDMI as selected via <a class="el" href="BUILD_INSTRUCTIONS.html#MAKEFILE_OPTIONS">Makefile and configuration options</a></li>
</ul>
</li>
<li>Type 'x' to exit the demo and run another demo</li>
</ul>
<h1><a class="anchor" id="run_in_pc_mode"></a>
Run vision apps on PC in PC emulation mode</h1>
<h2><a class="anchor" id="build_instruction_sec3"></a>
Running the TIOVX demos in PC emulation mode</h2>
<ul>
<li>Set environment variable below to specify the path of the test data. This is used by both the conformance test and tutorial executables, <div class="fragment"><div class="line">export VX_TEST_DATA_PATH=../../../../../conformance_tests/test_data</div></div><!-- fragment --></li>
<li>Do below execute the TIOVX tutorials <div class="fragment"><div class="line">cd tiovx/out/PC/x86_64/LINUX/$PROFILE</div><div class="line">./vx_tutorial_exe</div></div><!-- fragment --></li>
<li>Do below execute the TIOVX conformance tests <div class="fragment"><div class="line">cd tiovx/out/PC/x86_64/LINUX/$PROFILE</div><div class="line">./vx_conformance_tests_exe</div></div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Output .bmp/.png files generated by the tutorial and conformance tests should be present in the folder <b>tiovx/conformance_tests/test_data</b></dd></dl>
<h2><a class="anchor" id="build_instruction_sec4"></a>
Running the vision apps demos in PC emulation mode</h2>
<ul>
<li>Most of the demos take a config (.cfg) file as input which is used to specify various inputs and outputs to the demos<ul>
<li>A sample .cfg file is provide in each respective demo folder (<b>vision_apps/apps/[demo type]_demos/[demo name]/config</b>)</li>
</ul>
</li>
<li>TI provides reference test input for the demos<ul>
<li>Untar the file <b>psdk_rtos_ti_data_set_xx_xx_xx.tar.gz</b> to the folder "/ti/j7/workarea"</li>
<li>Untar the file <b>psdk_rtos_ti_data_set_xx_xx_xx_{SOC}.tar.gz</b> to the folder "/ti/j7/workarea"</li>
<li>If test data is NOT installed at "/ti/j7/workarea", then modify the demo .cfg files to point to the input data</li>
</ul>
</li>
<li>To run the demo copy the demo .cfg files to vision_apps/out/PC/x86_64/LINUX/$PROFILE</li>
<li>Run the specific demo by using below command <div class="fragment"><div class="line">cd vision_apps/out/PC/x86_64/LINUX/$PROFILE</div><div class="line">&lt;demo executable name&gt; --cfg &lt;cfg file&gt;</div></div><!-- fragment --></li>
<li>Refer to detailed demo pages for details on running each individual demo </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
