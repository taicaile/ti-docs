

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.1. ESM : Error Signalling Module &mdash; Software Diagnostics Library (SDL) - J721S2 User Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Software Diagnostics Library (SDL) - J721S2 User Guide" href="../index.html"/>
        <link rel="up" title="4. Modules" href="../family_cfg/j721s2/index_modules_j721s2.html"/>
        <link rel="next" title="4.2. ECC : Error Correcting Code" href="ecc.html"/>
        <link rel="prev" title="4. Modules" href="../family_cfg/j721s2/index_modules_j721s2.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index_j721s2.html" class="icon icon-home"> Software Diagnostics Library (SDL) - J721S2 User Guide
          

          
          </a>

          
            
            
              <div class="version">
                01_01_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_release_notes_j721s2.html">2. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../family_cfg/j721s2/index_modules_j721s2.html">4. Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. ESM : Error Signalling Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.1.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-usage">4.1.2. Example Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">4.1.3. Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">4.1.4. API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ecc.html">4.2. ECC : Error Correcting Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbist.html">4.3. PBIST : Memory Built-In Self-Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="lbist.html">4.4. LBIST : Logic Built-In Self-Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="vtm.html">4.5. VTM : Voltage and Thermal Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="rti.html">4.6. RTI : RTI/WWDT Windowed Watchdog Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="pok.html">4.7. POK: Power OK</a></li>
<li class="toctree-l2"><a class="reference internal" href="tog.html">4.8. TOG : Time-Out Gasket</a></li>
<li class="toctree-l2"><a class="reference internal" href="mtog.html">4.9. MTOG : Master Time-Out Gasket</a></li>
<li class="toctree-l2"><a class="reference internal" href="dcc.html">4.10. DCC : Dual Clock Comparator</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcrc.html">4.11. MCRC : Cyclic Redundancy Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="r5fccm.html">4.12. R5F CCM: CPU Compare Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="osal.html">4.13. OSAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="r5.html">4.14. R5 Core Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="rom_checksum.html">4.15. ROM_CHECKSUM: ROM Checksum Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_examples_j721s2.html">5. Safety Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diagnostic_mappings.html">6. Diagnostic Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_application_notes_j721s2.html">7. Developer Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index_j721s2.html">Software Diagnostics Library (SDL) - J721S2 User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index_j721s2.html">Docs</a> &raquo;</li>
      
          <li><a href="../family_cfg/j721s2/index_modules_j721s2.html"><span class="section-number">4. </span>Modules</a> &raquo;</li>
      
    <li><span class="section-number">4.1. </span>ESM : Error Signalling Module</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="esm-error-signalling-module">
<h1><span class="section-number">4.1. </span>ESM : Error Signalling Module<a class="headerlink" href="#esm-error-signalling-module" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">4.1.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Error Signaling Module (ESM) aggregates safety-related events and/or errors resulting from diagnostics from throughout the device into one location that can be monitored internally or externally. It allows designation of events as high priority or low priority interrupts, and also directly manipulate an I/O error pin to signal an external hardware (e.g. external monitor) that an error has occurred. Using the Error Signaling Module allows a single place in the SoC to manage these events, take corrective action, and clear error pin signaling external hardware if appropriate corrective action is taken. An external controller can monitor the error pin and is able to reset the device or keep the system in a safe, known state.</p>
<p>There can be multiple ESM instances on a device, and each one can support multiple error events that come from the various IP blocks in the device. Detailed information regarding the error events supported can be found in the device-specific TRM.</p>
<p>SDL provides the application with an interface to the ESM. Using SDL ESM, the application can initialize the ESM and listen for the desired error events from the device as well as configure the priority and error pin signaling of the events. As part of initialization of the ESM by the application, the application registers a callback for being notified of the error events. This is called by the SDL’s ESM Handler. SDL provides APIs for initializing and configuring the ESM for detecting the HW errors. The application can use the APIs to configure the ESM interrupts and priorities. Also, configuration of the error pin reporting is supported. SDL also provides the ability for the application to manipulate the error pin.</p>
<p>The SDL provides support for the ESM through:</p>
<ul class="simple">
<li><p>ESM Configuration API</p></li>
<li><p>ESM Handler for error handling and notification</p></li>
<li><p>ESM nError Pin manipulation API</p></li>
<li><p>ESM static register/written config readback APIs</p></li>
</ul>
<p>The following can be configured in ESM per instance for each supported event:</p>
<ul class="simple">
<li><p>Enable of interrupt for the event</p></li>
<li><p>Interrupt priority for the event</p></li>
<li><p>Enable nErrorPin assertion for the event</p></li>
</ul>
<p>The ESM Handler is responsible for handling the errors at runtime and notifying the application via registered callback. The registered callback will run in interrupt context.</p>
<p>On J721S2 there are 3 instances of the ESM: WKUP_ESM0 (Wakeup domain ESM), MCU_ESM0 (MCU Domain ESM), and ESM0 (Main domain ESM).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On the J721S2, the MCU_ESM0_ERR_O error output is connected to the WKUP_ESM0 as an error event input, but is not directly connected to the device pin. Due to this, if it is desired for the MCU ESM error events to be indicated on the error pin, then the corresponding ESM event that is associated with the ERR_O of the MCU ESM needs to be enabled in the WKUP ESM. Please refer to the Device TRM in the ESM Module Integration section for more information.</p>
</aside>
</section>
<section id="example-usage">
<h2><span class="section-number">4.1.2. </span>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of SDL ESM API usage by the application to set up the ESM to monitor for specific safety events.</p>
<p>In this example, the application configures the ESM for a particular ESM Instance. If there are multiple ESM instances on a device, then all instances for which the application wishes to listen for error events need to be configured. In this example we will configure only one of the ESM Instances</p>
<p>First, we need to decide which event(s) we want to enable, at what priority, and what error pin behavior is desired. To do this, we can reference the <a class="reference external" href="http://www.ti.com/lit/pdf/spruil1">J721S2 Technical Reference Manual</a> to find the ESM error events for each ESM instance. In this example, let’s say that we have reviewed the TRM, and we have decided that we want to</p>
<ul class="simple">
<li><p>monitor ESM events 10, 11, and 16 for a particular instance</p></li>
<li><p>configure event 10 and 11 to be of High priority and to signal on the error pin</p></li>
<li><p>configure event 16 to be Low priority and not to signal on the error pin</p></li>
</ul>
<p>We will set up our ESM config like this:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SDL_ESM_config<span class="w"> </span><span class="nv">esmInitConfig_WKUP</span><span class="w"> </span><span class="o">=</span>
<span class="o">{</span>
<span class="w">    </span>.esmErrorConfig<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0u,<span class="w"> </span>8u<span class="o">}</span>,<span class="w"> </span>/*<span class="w"> </span>Self<span class="w"> </span><span class="nb">test</span><span class="w"> </span>error<span class="w"> </span>config<span class="w"> </span>-<span class="w"> </span>error<span class="w"> </span>event<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span><span class="k">for</span><span class="w"> </span>self<span class="w"> </span><span class="nb">test</span><span class="w"> </span>*/
<span class="w">    </span>.enableBitmap<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x00010c00u,<span class="w"> </span>0x00000000u,<span class="w"> </span>0x00000000u<span class="o">}</span>,
<span class="w">    </span>/**&lt;<span class="w"> </span>Enable<span class="w"> </span>events<span class="w"> </span><span class="m">10</span>,<span class="w"> </span><span class="m">11</span><span class="w"> </span>and<span class="w"> </span><span class="m">16</span>.<span class="w"> </span>All<span class="w"> </span>other<span class="w"> </span>events<span class="w"> </span>disabled.<span class="w"> </span>*/
<span class="w">    </span>.priorityBitmap<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x00000c00u,<span class="w"> </span>0x00000000u,<span class="w"> </span>0x00000000u<span class="o">}</span>,
<span class="w">    </span>/**&lt;<span class="w"> </span>Events<span class="w"> </span><span class="m">10</span><span class="w"> </span>and<span class="w"> </span><span class="m">11</span><span class="w"> </span>high<span class="w"> </span>priority,<span class="w"> </span>event<span class="w"> </span><span class="m">16</span><span class="w"> </span>low<span class="w"> </span>priority<span class="w"> </span>*/
<span class="w">    </span>.errorpinBitmap<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x00000c00u,<span class="w"> </span>0x00000000u,<span class="w"> </span>0x00000000u<span class="o">}</span>,
<span class="w">    </span>/**&lt;<span class="w"> </span>Events<span class="w"> </span><span class="m">10</span><span class="w"> </span>and<span class="w"> </span><span class="m">11</span><span class="w"> </span>signal<span class="w"> </span>the<span class="w"> </span>error<span class="w"> </span>pin,<span class="w"> </span>event<span class="w"> </span><span class="m">16</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>*/
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Additionally, application should define the callback function through which it will receive ESM notifications, for example:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>int32_t<span class="w"> </span>SDL_ESM_applicationCallbackFunction<span class="o">(</span>SDL_ESM_Inst<span class="w"> </span>esmInst,
<span class="w">                                            </span>SDL_ESM_IntType<span class="w"> </span>esmIntrType,
<span class="w">                                            </span>uint32_t<span class="w"> </span>grpChannel,
<span class="w">                                            </span>uint32_t<span class="w"> </span>index,
<span class="w">                                            </span>uint32_t<span class="w"> </span>intSrc,
<span class="w">                                            </span>void<span class="w"> </span>*arg<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>int32_t<span class="w"> </span><span class="nv">retVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SDL_PASS<span class="p">;</span>
<span class="w">    </span>UART_printf<span class="o">(</span><span class="s2">&quot;\n  ESM Call back function called : instType 0x%x, intType 0x%x, &quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">                </span><span class="s2">&quot;grpChannel 0x%x, index 0x%x, intSrc 0x%x \n&quot;</span>,
<span class="w">                </span>esmInst,<span class="w"> </span>esmIntrType,<span class="w"> </span>grpChannel,<span class="w"> </span>index,<span class="w"> </span>intSrc<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>UART_printf<span class="o">(</span><span class="s2">&quot;  Take action \n&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>/*<span class="w"> </span>Any<span class="w"> </span>additional<span class="w"> </span>application<span class="w"> </span>specific<span class="w"> </span>actions<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>added<span class="w"> </span>here<span class="w"> </span>*/

<span class="w">    </span><span class="k">return</span><span class="w"> </span>retVal<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Now we can call the SDL_ESM_init API:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SDL_ESM_init<span class="o">(</span>SDL_ESM_INST_WKUP_ESM0,<span class="w"> </span><span class="p">&amp;</span>esmInitConfig_WKUP,<span class="w"> </span>SDL_ESM_applicationCallbackFunction,ptr<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>ret<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>SDL_PASS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>//<span class="w"> </span>handle<span class="w"> </span>error
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p>When error events occur, the Application’s registered callback will be invoked and the application can take action as needed.</p>
<p>If an error pin is asserted due to an error event, the application can additionally decide to clear the error pin:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SDL_ESM_clearNError<span class="o">(</span>SDL_ESM_INST_WKUP_ESM0<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that the pin will remain active for the minimum time interval even after being cleared. Once the minimum time interval expires, the clear will take affect.</p>
<p>The application can also force the error pin active:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SDL_ESM_setNError<span class="o">(</span>SDL_ESM_INST_WKUP_ESM0<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>The SDL ESM also provides APIs to assist in implementing diagnostics related to static config register readback and readback of written config.
In order to verify the written config, after calling SDL_ESM_init, SDL_ESM_verifyConfig may be called:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SDL_ESM_verifyConfig<span class="o">(</span>SDL_ESM_INST_WKUP_ESM0,<span class="w"> </span>esmInitConfig_WKUP<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>ret<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>SDL_PASS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>//<span class="w"> </span>verification<span class="w"> </span>failed
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<p>In order to readback the static config:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SDL_ESM_getStaticRegisters<span class="o">(</span>SDL_ESM_INST_WKUP_ESM0,<span class="w"> </span><span class="p">&amp;</span>staticRegs<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="examples">
<h2><span class="section-number">4.1.3. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The ESM module provide a Safety Example to show how to use ESM for some typical use-cases. Details regarding the ESM Safety Example can be found <a class="reference external" href="../examples/esm.html">here</a>.</p>
<p>Test apps that are meant for verifying the functionality of the module are also provided.</p>
</section>
<section id="api">
<h2><span class="section-number">4.1.4. </span>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="../../../apiguide/j721s2/html/group__SDL__ESM__API.html">ESM API Guide</a></p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ecc.html" class="btn btn-neutral float-right" title="4.2. ECC : Error Correcting Code" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../family_cfg/j721s2/index_modules_j721s2.html" class="btn btn-neutral" title="4. Modules" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2021</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'01_01_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>